## 1. 개요: CloudFront 엣지 함수란?

CloudFront는 단순한 콘텐츠 전송(CDN)을 넘어, 전 세계 엣지 로케이션에서 사용자 지정 코드를 실행할 수 있는 기능을 제공합니다. 이를 통해 서버를 거치지 않고 사용자 인터랙션을 즉각적으로 처리할 수 있습니다.

* **특징:** 서버리스, 전 세계 배포, 저대기 시간(Low Latency).
* **주요 용도:** HTTP 요청/응답 조작, 보안 필터링, 사용자 인증(JWT), A/B 테스트, 봇 미티게이션 등.

---

## 2. CloudFront Functions vs Lambda@Edge 비교

| 구분 | CloudFront Functions | Lambda@Edge |
| --- | --- | --- |
| **실행 위치** | **엣지 로케이션** (최전방) | **리전 엣지 캐시** (REC) |
| **언어** | JavaScript (경량) | Node.js, Python |
| **확장성** | 초당 수백만 건 (매우 높음) | 초당 수천 건 |
| **트리거 지점** | 뷰어 요청/응답만 가능 | 뷰어/오리진 요청/응답 모두 가능 |
| **최대 실행 시간** | **1ms 미만** (초고속) | 5초(뷰어) / 30초(오리진) |
| **네트워크/파일시스템** | 액세스 불가 | **액세스 가능** (외부 API 호출 가능) |
| **본문(Body) 액세스** | 불가 | **가능** |
| **비용** | 매우 저렴 (프리 티어 제공) | 상대적 고가 (프리 티어 없음) |

---

## 3. 상세 분석

### ① CloudFront Functions (초경량/초고속)

가장 사용자와 가까운 곳에서 실행되며, 성능에 민감한 대규모 요청 처리에 최적화되어 있습니다.

* **주요 사례:**
* **캐시 키 정규화:** 헤더, 쿠키, 쿼리 스트링을 변환하여 캐시 효율 증대.
* **헤더 조작:** HTTP 헤더 삽입/수정/삭제.
* **URL 리다이렉트/다시 쓰기:** 단순 경로 변경.
* **권한 부여:** JWT 토큰 검증(단순 계산 로직).



### ② Lambda@Edge (고성능/다기능)

복잡한 비즈니스 로직이 필요하거나 외부 리소스에 접근해야 할 때 사용합니다.

* **주요 사례:**
* **외부 서비스 호출:** 다른 AWS 서비스(S3, DynamoDB)나 서드파티 API 연동.
* **User-Agent 기반 처리:** 사용자 기기별(모바일/데스크톱) 맞춤형 콘텐츠(이미지 해상도 등) 제공.
* **본문 조작:** HTTP 요청 본문 데이터 수정.
* **글로벌 애플리케이션:** 엣지에서 직접 데이터베이스 쿼리 수행.



---

## 4. CloudFront 이벤트 트리거의 이해

1. **Viewer Request:** CloudFront가 사용자로부터 요청을 받았을 때. (둘 다 사용 가능)
2. **Origin Request:** CloudFront가 오리진(S3, ALB 등)으로 요청을 보내기 전. (**Lambda@Edge만 가능**)
3. **Origin Response:** CloudFront가 오리진으로부터 응답을 받았을 때. (**Lambda@Edge만 가능**)
4. **Viewer Response:** CloudFront가 사용자에게 응답을 보내기 전. (둘 다 사용 가능)

---

## 5. 실무 활용 예시

### 예시 1: 기기별 이미지 최적화 (Lambda@Edge)

1. 사용자가 `cat.jpg` 요청.
2. Lambda@Edge가 `User-Agent` 헤더 확인.
3. 모바일 기기인 경우, 요청 URL을 `cat-mobile.jpg`로 수정하여 S3에 요청.
4. 사용자는 자신의 기기에 맞는 최적화된 이미지를 수신.

### 예시 2: 엣지 인증 (CloudFront Functions)

1. 사용자가 요청 시 헤더에 JWT 포함.
2. CloudFront Function이 즉각적으로 토큰 유효성 검사 (1ms 이내).
3. 비정상 토큰일 경우 오리진까지 가지 않고 엣지에서 즉시 거부(403).

---

## 💡 요약: 무엇을 선택해야 할까?

* **성능, 비용, 단순 변환**이 우선이라면? → **CloudFront Functions**
* **네트워크 호출, 본문 수정, 복잡한 로직**이 필요하다면? → **Lambda@Edge**
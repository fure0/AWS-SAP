## 1. 개요: 왜 Transit Gateway(TGW)인가?

기존의 VPC 피어링(Peering) 방식은 연결해야 할 VPC와 온프레미스 환경이 늘어날수록 관리가 기하급수적으로 복잡해지는 단점이 있었습니다.

* **기존 방식의 문제점:** 수많은 VPC 간의 1:1 피어링 연결, 개별적인 VPN 연결 등으로 인해 네트워크 토폴로지가 복잡해짐 (Mesh 구조).
* **Transit Gateway의 등장:** 수천 개의 VPC와 온프레미스 네트워크를 중앙에서 연결하는 **허브 앤 스포크(Hub-and-Spoke)** 방식의 서비스입니다.

---

## 2. Transit Gateway의 주요 특징

* **허브 앤 스포크 아키텍처:** 중앙의 TGW가 허브 역할을 하며 모든 트래픽을 제어하고 라우팅합니다.
* **전이적 라우팅(Transitive Routing) 지원:** VPC A - TGW - VPC B 구조에서 A와 B가 서로 통신할 수 있는 전이성을 제공합니다. (기존 VPC 피어링은 전이성 불가)
* **리전 및 계정 간 연결:**
* **리전 리소스:** 특정 리전에 생성되지만, **TGW 피어링**을 통해 서로 다른 리전의 TGW를 연결할 수 있습니다.
* **Resource Access Manager(RAM):** RAM을 사용하여 하나의 TGW를 여러 AWS 계정과 공유할 수 있습니다.


* **멀티캐스트(Multicast) 지원:** AWS 내에서 **IP 멀티캐스트를 지원하는 유일한 서비스**입니다. 멀티캐스트가 필요한 애플리케이션이라면 반드시 TGW를 사용해야 합니다.
* **보안 및 제어:** TGW 수준의 **라우트 테이블**을 통해 어떤 VPC끼리 통신할지 정교하게 제어할 수 있습니다.

---

## 3. 핵심 아키텍처: 중앙 집중형 이그레스(Egress) VPC

여러 VPC의 인터넷 트래픽을 하나의 VPC로 모아서 나가는 구조입니다. 비용 절감과 보안 통제에 매우 유리합니다.

### 아키텍처 구성

1. **Egress VPC:** 인터넷 게이트웨이(IGW)와 NAT 게이트웨이를 배치합니다.
2. **App VPC (1, 2...):** 사설 서브넷만 가지며, 직접적인 인터넷 연결이 없습니다.
3. **TGW 연결:** 각 VPC를 TGW에 연결(Attachment)합니다.

### 트래픽 흐름

* App VPC의 라우트 테이블에서 `0.0.0.0/0`(모든 인터넷 트래픽)의 대상(Next Hop)을 **TGW**로 설정합니다.
* TGW는 해당 트래픽을 받아 **Egress VPC**에 있는 ENI(탄력적 네트워크 인터페이스)로 보냅니다.
* Egress VPC의 NAT 게이트웨이를 거쳐 인터넷으로 나갑니다.

> **장점:** VPC마다 NAT 게이트웨이를 만들 필요가 없어 **비용이 절감**되며, 모든 외부 트래픽을 한곳에서 모니터링할 수 있습니다.

---

## 4. 네트워크 격리 및 세분화 (Isolation)

TGW 라우트 테이블을 여러 개 생성하여 논리적으로 네트워크를 격리할 수 있습니다.

| 라우트 테이블 유형 | 연결 대상 (Propagation) | 특징 |
| --- | --- | --- |
| **Prod용 RT** | 운영(Prod) 계정 VPC, 프리프로드 VPC | 운영 환경끼리만 통신 허용 |
| **Staging용 RT** | 스테이징 계정 VPC, 개발(Dev) 계정 VPC | 테스트 환경끼리만 통신 허용 |

* **결과:** 동일한 TGW를 공유하더라도 라우트 테이블 설정에 따라 Prod VPC와 Dev VPC는 서로 통신할 수 없도록 격리됩니다.

---

## 5. 리전 간 피어링 및 다이렉트 커넥트(DX) 연결

* **Direct Connect(DX) 연동:** 다이렉트 커넥트 게이트웨이를 TGW에 연결하여 온프레미스와 여러 리전의 VPC를 한꺼번에 연결할 수 있습니다.
* **리전 간 TGW 피어링:**
* 서로 다른 리전의 TGW를 연결하여 전 세계적인 AWS 네트워크망을 구축합니다.
* **비용 구조:** 피어링 연결 자체에 대한 시간당 요금이 발생합니다. 리전 간 데이터 전송 시에는 표준 데이터 전송 비용이 발생하지만, **TGW 데이터 처리 수수료는 부과되지 않는 특징**이 있습니다.



---

## 6. 요약 및 핵심 포인트

1. **복잡성 해결:** 수많은 연결을 중앙 집중화하여 단순화함.
2. **확장성:** 수천 개의 VPC와 연결 가능.
3. **공유:** RAM을 통한 멀티 계정 환경 지원.
4. **특수 기능:** IP 멀티캐스트 지원, 중앙 집중형 NAT 구조 가능.
5. **라우팅 제어:** TGW 라우트 테이블을 통한 강력한 네트워크 보안 정책 적용.

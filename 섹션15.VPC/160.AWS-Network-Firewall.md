## 1. AWS 네트워크 보안 서비스 요약

새로운 내용을 배우기 전, 기존에 다뤘던 주요 보안 서비스들을 가볍게 짚어봅니다.

| 서비스 | 주요 역할 |
| --- | --- |
| **NACL (네트워크 ACL)** | 서브넷 수준의 기본 방화벽 (Stateless) |
| **보안 그룹 (Security Group)** | 인스턴스 수준의 기본 방화벽 (Stateful) |
| **AWS WAF** | HTTP/HTTPS 요청을 분석하여 L7 계층의 악의적인 공격 방어 |
| **AWS Shield / Shield Advanced** | DDoS 공격으로부터 리소스 보호 |
| **AWS Firewall Manager** | 여러 계정의 WAF, Shield, Network Firewall 규칙을 중앙 관리 |

---

## 2. AWS Network Firewall 이란?

VPC 전체를 정교하게 보호하기 위해 도입된 **관리형 방화벽 서비스**입니다. VPC 주위를 둘러싸는 형태로 배치되어 모든 방향의 트래픽을 검사합니다.

### 주요 특징

* **범위:** 계층 3(L3)부터 계층 7(L7)까지 폭넓은 보호 제공.
* **트래픽 검사 방향:** * 인터넷 인바운드/아웃바운드
* VPC 간 트래픽 (East-West)
* Direct Connect 및 Site-to-Site VPN 연결 트래픽


* **관리 방식:** 내부적으로 **Gateway Load Balancer(GWLB)**를 사용하지만, 사용자가 직접 어플라이언스를 관리할 필요 없이 AWS가 모두 관리합니다.
* **성능:** VPC 수준에서 수천 개의 규칙과 수만 개의 IP/포트 필터링을 지원합니다.

### 필터링 기능

* **프로토콜 제어:** 특정 프로토콜(예: SMB) 비활성화 가능.
* **도메인 필터링:** 특정 도메인(예: 회사 전용 도메인, 소프트웨어 레포지토리)으로의 아웃바운드만 허용.
* **Regex 패턴 매칭:** 정규 표현식을 사용한 일반 패턴 매칭 지원.
* **액티브 플로우 검사:** 침입 방지 시스템(IPS) 기능을 통한 실시간 위협 차단.
* **로깅 및 분석:** 규칙에 매칭된 트래픽을 S3, CloudWatch Logs, Kinesis Data Firehose로 전송하여 분석 가능.

---

## 3. 네트워크 방화벽 아키텍처 (중앙 집중형 검사)

복잡한 환경에서는 **AWS Transit Gateway(TGW)**를 중앙에 두고, 모든 트래픽이 **검사 VPC(Inspection VPC)**에 있는 Network Firewall을 거치도록 구성합니다.

### 트래픽 흐름 패턴

#### ① North-South (VPC to Internet)

VPC 내부 인스턴스가 인터넷으로 나갈 때의 흐름입니다.

1. **Source VPC** 인스턴스 → **Transit Gateway**
2. **Transit Gateway** → **검사 VPC (Network Firewall 검사)**
3. **검사 VPC** → **Transit Gateway** (검사 완료 후 복귀)
4. **Transit Gateway** → **Egress VPC** (NAT/IGW) → **Internet**

#### ② On-premises (VPC to Data Center)

회사 데이터 센터와 통신할 때의 흐름입니다.

1. **VPC 인스턴스** → **Transit Gateway**
2. **Transit Gateway** → **검사 VPC (Network Firewall)** → **Transit Gateway**
3. **Transit Gateway** → **VPN / Direct Connect** → **온프레미스 DC**

#### ③ East-West (VPC to VPC)

VPC 간에 통신할 때의 흐름입니다.

1. **VPC A 인스턴스** → **Transit Gateway**
2. **Transit Gateway** → **검사 VPC (Network Firewall)** → **Transit Gateway**
3. **Transit Gateway** → **VPC B 인스턴스**

---

### 💡 요약 한 줄

> "모든 트래픽은 목적지로 가기 전, 반드시 **Transit Gateway**를 통해 **Network Firewall**이 있는 **검사 VPC**를 들러 '검문'을 받아야 한다."
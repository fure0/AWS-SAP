# ☁️ AWS VPC Peering 핵심 요약 정리

## 1. VPC 피어링(Peering)의 기본 개념

VPC 피어링은 두 개의 VPC 간에 트래픽을 지정할 수 있게 하는 네트워킹 연결입니다.

* **연결 방식:** AWS의 프라이빗 네트워크 망을 이용해 통신합니다.
* **사용 목적:** 서로 다른 VPC가 마치 **하나의 동일한 네트워크**에 있는 것처럼 프라이빗하게 통신하기 위함입니다.
* **범위:** 동일 계정 내는 물론, **다른 AWS 계정** 및 **다른 리전(Region)** 간의 연결도 지원합니다.
* **보안 그룹 참조:** 피어링이 설정되면 다른 VPC의 보안 그룹(Security Group)을 소스/데스티네이션으로 참조할 수 있어 보안 관리가 용이합니다.

---

## 2. 주요 특징 및 설정 조건

VPC 피어링을 성공적으로 운영하기 위해 반드시 알아야 할 규칙입니다.

### ① 비전이성 (Non-Transitive)

VPC 피어링은 **'다리를 건너서' 통신할 수 없습니다.**

* A와 B가 연결되어 있고, A와 C가 연결되어 있어도 **B와 C는 직접 연결 없이는 통신이 불가능**합니다.
* B와 C가 통신하려면 반드시 B-C 간의 피어링 연결을 별도로 생성해야 합니다.

### ② 라우팅 테이블 업데이트

피어링 연결만 생성한다고 통신이 되는 것은 아닙니다.

* **양방향 설정:** VPC A와 VPC B **각각의 서브넷 라우팅 테이블**에 상대방 VPC CIDR로 향하는 타겟을 피어링 연결 ID(`pcx-xxxx`)로 지정해야 합니다.

### ③ CIDR 중복 불가 (Overlapping CIDR)

* 두 VPC 간에 IP 대역(CIDR)이 하나라도 겹치면 피어링을 생성할 수 없습니다.
* IPv4 대역이 같으면 IPv6 대역이 다르더라도 연결이 불가능합니다.

---

## 3. 최장 접두사 일치 (Longest Prefix Match)

VPC 내에서 트래픽을 어디로 보낼지 결정할 때, **가장 구체적인(Prefix가 긴) 경로**를 우선시합니다.

| 목적지 (Destination) | 타겟 (Target) | 설명 |
| --- | --- | --- |
| `10.0.0.77/32` | Peering (VPC B) | 특정 인스턴스 IP이므로 **최우선 순위** |
| `10.0.0.0/16` | Peering (VPC C) | 일반적인 대역이므로 후순위 |
| `172.x.x.x/16` | Local | 자신의 VPC 내부 통신 |

> **예시:** 특정 IP(`10.0.0.77`)는 VPC B로 보내고, 그 외 나머지 `10.0.0.0/16` 대역은 VPC C로 보내도록 정교한 라우팅 설계가 가능합니다.

---

## 4. VPC 피어링의 제약 사항 (중요!)

시험에 자주 출제되는 **'불가능한 구성'**들입니다.

### ① 엣지 간 라우팅 불가 (No Edge-to-Edge Routing)

VPC 피어링은 다른 연결 수단(Gateway 등)을 **거쳐가는 통로로 사용할 수 없습니다.**

* **Case 1 (VPN/Direct Connect):** 기업 데이터 센터 - [VPC A] - [VPC B] 구조에서, VPC B는 VPC A를 거쳐 데이터 센터로 갈 수 없습니다.
* **Case 2 (Internet Gateway):** 인터넷 - [IGW - VPC A] - [VPC B] 구조에서, VPC B는 VPC A의 인터넷 게이트웨이를 빌려 쓸 수 없습니다.
* **Case 3 (NAT Gateway):** 여러 VPC가 중앙 VPC의 NAT Gateway 하나를 공유하여 인터넷에 접속하는 구성은 **피어링만으로는 불가능**합니다. (VPC 피어링은 NAT 기기와의 엣지 라우팅을 지원하지 않음)
* **Case 4 (VPC Endpoints):** S3/DynamoDB용 게이트웨이 엔드포인트도 피어링을 통해 공유할 수 없습니다.

---

## 5. 요약 및 결론

* **VPC 피어링**은 간단하고 프라이빗한 연결을 제공하지만, **전이되지 않고 엣지 라우팅이 불가능**하다는 명확한 한계가 있습니다.
* 대규모 환경에서 중앙 집중식 인터넷 연결이나 복잡한 전이형 연결이 필요하다면, 추후 학습할 **Transit Gateway**가 그 해결책이 됩니다.
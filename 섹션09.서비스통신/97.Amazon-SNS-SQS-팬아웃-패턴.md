# â˜ï¸ AWS SNS + SQS: Fan Out íŒ¨í„´ ë° ê³ ê¸‰ ê¸°ëŠ¥ ì •ë¦¬

## 1. Fan Out íŒ¨í„´ ê°œìš”

Fan Out íŒ¨í„´ì€ í•˜ë‚˜ì˜ ë©”ì‹œì§€ë¥¼ ì—¬ëŸ¬ ìˆ˜ì‹ ì²˜ë¡œ ë™ì‹œì— ì „ë‹¬í•´ì•¼ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì„¤ê³„ ë°©ì‹ì…ë‹ˆë‹¤.

* **ë¬¸ì œì :** ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—¬ëŸ¬ SQS ëŒ€ê¸°ì—´ì— ì§ì ‘ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´, ì „ì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ê´€ë¦¬ë‚˜ ëŒ€ê¸°ì—´ ì¶”ê°€ ì‹œ ì½”ë“œ ìˆ˜ì •ì´ í•„ìš”í•˜ì—¬ ë³µì¡ì„±ì´ ì¦ê°€í•©ë‹ˆë‹¤.
* **í•´ê²°ì±…:** **SNS í† í”½**ì— ë©”ì‹œì§€ë¥¼ í•œ ë²ˆë§Œ ê²Œì‹œí•˜ê³ , ì—¬ëŸ¬ ê°œì˜ **SQS ëŒ€ê¸°ì—´**ì„ í•´ë‹¹ í† í”½ì˜ êµ¬ë…ì(Subscriber)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### íŠ¹ì§• ë° ì¥ì 

* **ë””ì»¤í”Œë§(Decoupling):** ì†¡ì‹ ìì™€ ìˆ˜ì‹ ìê°€ ì™„ì „íˆ ë¶„ë¦¬ëœ ëª¨ë¸ì…ë‹ˆë‹¤.
* **ë°ì´í„° ì§€ì†ì„±:** SQSë¥¼ í†µí•´ ë°ì´í„° ìœ ì‹¤ ë°©ì§€, ì§€ì—° ì²˜ë¦¬, ì‘ì—… ì¬ì‹œë„ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **í™•ì¥ì„±:** ê¸°ì¡´ ì‹œìŠ¤í…œì— ì˜í–¥ ì—†ì´ ìƒˆë¡œìš´ SQS ëŒ€ê¸°ì—´(êµ¬ë…ì)ì„ ì–¸ì œë“  ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê¶Œí•œ ì„¤ì •:** SNS í† í”½ì´ SQS ëŒ€ê¸°ì—´ì— ë©”ì‹œì§€ë¥¼ ì“¸ ìˆ˜ ìˆë„ë¡ **SQS ëŒ€ê¸°ì—´ ì ‘ê·¼ ì •ì±…(Access Policy)**ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
* **êµì°¨ ë¦¬ì „(Cross-Region):** ë³´ì•ˆ ì„¤ì •ì´ í—ˆìš©ëœë‹¤ë©´ í•œ ë¦¬ì „ì˜ SNS í† í”½ì´ ë‹¤ë¥¸ ë¦¬ì „ì˜ SQS ëŒ€ê¸°ì—´ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 2. ì£¼ìš” í™œìš© ì‚¬ë¡€

### â‘  S3 ì´ë²¤íŠ¸ ì•Œë¦¼ í™•ì¥

* **ì œí•œ ì‚¬í•­:** S3 ë²„í‚·ì˜ íŠ¹ì • ì ‘ë‘ì‚¬(ì˜ˆ: `images/`)ì— ëŒ€í•´ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ ê·œì¹™ì€ ì˜¤ì§ í•˜ë‚˜ì…ë‹ˆë‹¤.
* **í•´ê²° ë°©ë²•:** S3 ì´ë²¤íŠ¸ë¥¼ SNS í† í”½ìœ¼ë¡œ ë¨¼ì € ë³´ë‚´ê³ , ì´ í† í”½ì„ ì—¬ëŸ¬ SQS ëŒ€ê¸°ì—´, Lambda, ì´ë©”ì¼ ë“±ì´ êµ¬ë…í•˜ê²Œ í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### â‘¡ SNSì™€ Kinesis Data Firehose(KDF) í†µí•©

* SNSëŠ” KDFì™€ ì§ì ‘ í†µí•©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
* **íë¦„:** `ì„œë¹„ìŠ¤ -> SNS Topic -> KDF -> Amazon S3` (ë˜ëŠ” KDFê°€ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ëª©ì ì§€)
* ì´ ë°©ì‹ì„ í†µí•´ SNSë¡œ ë“¤ì–´ì˜¤ëŠ” ë©”ì‹œì§€ë¥¼ S3ì— ë°±ì—…í•˜ê±°ë‚˜ ë¶„ì„ìš© ë°ì´í„°ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 3. SNS FIFO (First-In-First-Out)

ë©”ì‹œì§€ì˜ ìˆœì„œ ë³´ì¥ê³¼ ì¤‘ë³µ ì œê±°ê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©í•©ë‹ˆë‹¤.

* **ìˆœì„œ ë³´ì¥:** ìƒì‚°ìê°€ ë³´ë‚¸ ìˆœì„œ(1, 2, 3, 4) ê·¸ëŒ€ë¡œ êµ¬ë…ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.
* **êµ¬ë…ì ì œí•œ:** ë°˜ë“œì‹œ **SQS FIFO ëŒ€ê¸°ì—´**ë§Œ êµ¬ë…ìë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ìˆœì„œ ë³´ì¥ì„ ìœ„í•´)
* **ì£¼ìš” ê¸°ëŠ¥:**
* **ë©”ì‹œì§€ ê·¸ë£¹ ID:** IDë³„ë¡œ ë©”ì‹œì§€ë¥¼ ì •ë ¬í•©ë‹ˆë‹¤.
* **ì¤‘ë³µ ì œê±° ID:** ì¤‘ë³µëœ ë©”ì‹œì§€ ì „ë‹¬ì„ ë°©ì§€í•©ë‹ˆë‹¤.


* **ì²˜ë¦¬ëŸ‰:** SQS FIFOì™€ ë™ì¼í•œ ìˆ˜ì¤€ì˜ ì œí•œëœ ì²˜ë¦¬ëŸ‰ì„ ê°€ì§‘ë‹ˆë‹¤.

---

## 4. SNS ë©”ì‹œì§€ í•„í„°ë§ (Message Filtering)

êµ¬ë…ìê°€ í† í”½ì˜ ëª¨ë“  ë©”ì‹œì§€ê°€ ì•„ë‹Œ, **íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ë©”ì‹œì§€ë§Œ** ê³¨ë¼ì„œ ë°›ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **ì‘ë™ ë°©ì‹:** êµ¬ë…(Subscription) ì„¤ì • ì‹œ **JSON í˜•íƒœì˜ í•„í„°ë§ ì •ì±…**ì„ ì ìš©í•©ë‹ˆë‹¤.
* **ê¸°ë³¸ê°’:** ì •ì±…ì´ ì—†ìœ¼ë©´ í† í”½ì˜ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
* **ì˜ˆì‹œ (ì£¼ë¬¸ ì‹œìŠ¤í…œ):**
| êµ¬ë…ì | í•„í„°ë§ ì •ì±… ì¡°ê±´ | ê²°ê³¼ |
| :--- | :--- | :--- |
| **SQS 1 (ë°œì£¼ ì²˜ë¦¬)** | `status: "placed"` | ë°œì£¼ëœ ì£¼ë¬¸ ë©”ì‹œì§€ë§Œ ìˆ˜ì‹  |
| **SQS 2 (ì·¨ì†Œ ì²˜ë¦¬)** | `status: "cancelled"` | ì·¨ì†Œëœ ì£¼ë¬¸ ë©”ì‹œì§€ë§Œ ìˆ˜ì‹  |
| **ì´ë©”ì¼ (ì•Œë¦¼)** | `status: "cancelled"` | ì·¨ì†Œëœ ê²½ìš°ì—ë§Œ ê´€ë¦¬ìì—ê²Œ ë©”ì¼ ë°œì†¡ |
| **SQS 3 (ë¡œê·¸ìš©)** | ì •ì±… ì—†ìŒ | ëª¨ë“  ì£¼ë¬¸ ë©”ì‹œì§€(ë°œì£¼, ì·¨ì†Œ, ê±°ì ˆ ë“±) ìˆ˜ì‹  |

---

### ğŸ’¡ ì‹œí—˜ ëŒ€ë¹„ í•µì‹¬ í¬ì¸íŠ¸

> 1. **S3 ì´ë²¤íŠ¸ë¥¼ ì—¬ëŸ¬ ê³³ìœ¼ë¡œ ë³´ë‚´ì•¼ í•œë‹¤ë©´?** -> SNS Fan Outì´ ì •ë‹µ.
> 2. **ë©”ì‹œì§€ ìˆœì„œê°€ ì¤‘ìš”í•˜ê³  ì—¬ëŸ¬ ëŒ€ê¸°ì—´ì— ë¶„ì‚°í•´ì•¼ í•œë‹¤ë©´?** -> SNS FIFO + SQS FIFO ì¡°í•©.
> 3. **íŠ¹ì • ì¡°ê±´ì˜ ë©”ì‹œì§€ë§Œ ê³¨ë¼ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´?** -> SNS í•„í„°ë§ ì •ì±…(JSON) í™œìš©.
> 4. **SQSê°€ SNSë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ì§€ ëª»í•œë‹¤ë©´?** -> SQSì˜ Access Policy(ì ‘ê·¼ ì •ì±…) í™•ì¸.
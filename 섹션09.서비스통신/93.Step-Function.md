## 1. Step Functions 개요

Step Functions는 **서버리스 시각적 워크플로 서비스**로, 여러 AWS 서비스(특히 Lambda)를 오케스트레이션하여 분산 애플리케이션을 구축할 때 사용합니다.

* **구현 방식**: JSON 기반의 **ASL(Amazon States Language)**을 사용하여 상태 머신(State Machine)을 정의합니다.
* **시각적 인터페이스**: 워크플로의 흐름을 그래프로 확인할 수 있으며, 실시간 실행 상태(성공, 실패, 진행 중 등)를 모니터링할 수 있습니다.
* **장점**: 시퀀스 액션, 병렬 처리, 조건문, 타임아웃, 오류 처리 등을 코드 없이 설정 가능합니다.

---

## 2. 주요 기능 및 통합 서비스

Step Functions는 단순한 함수 호출을 넘어 200개가 넘는 AWS 서비스와 직접 통합됩니다.

* **주요 통합 서비스**:
  * **Computing**: Lambda 호출, AWS Batch 작업, ECS/Fargate 작업 실행(완료 시까지 대기 가능).
  * **Database/Storage**: DynamoDB 아이템 삽입/조회, S3 데이터 처리.
  * **Messaging**: SNS 메시지 게시, SQS 메시지 전송.
  * **Data/ML**: EMR, Glue, SageMaker 작업 관리.


* **특이 사항**: SDK 통합을 통해 별도의 Lambda 없이도 대부분의 AWS 서비스 API를 직접 호출할 수 있습니다.

---

## 3. 태스크(Task) 유형

워크플로 내에서 수행되는 작업 단위입니다.

1. **Lambda Tasks**: AWS Lambda 함수를 호출합니다.
2. **Activity Tasks**: EC2, 온프레미스, 모바일 등 외부 워커가 Step Functions에 작업이 있는지 묻고(Polling) 가져가서 실행하는 방식입니다. (서버리스 아님)
3. **Service Tasks**: 지원되는 AWS 서비스(DynamoDB, SNS 등)와 직접 연결됩니다.
4. **Wait Task**: 특정 시간 동안 대기하거나 특정 타임스탬프까지 실행을 멈춥니다.

> **⚠️ 시험 팁 (Mechanical Turk)**
> AWS Mechanical Turk(사람의 개입이 필요한 작업)와 **자동 통합되지 않습니다.** 사람의 작업이 깊게 관여되는 워크플로는 **SWF(Simple Workflow Service)** 사용을 고려해야 합니다.

---

## 4. 표준(Standard) vs 익스프레스(Express) 워크플로

시험에서 가장 자주 출제되는 비교 포인트입니다.

| 구분 | 표준 (Standard) | 익스프레스 (Express) |
| --- | --- | --- |
| **최대 실행 시간** | **최대 1년** (장기 워크플로) | **최대 5분** (단기 처리) |
| **처리량** | 초당 2,000개 시작 | 초당 100,000개 이상 시작 |
| **가격 정책** | **상태 전환(State Transition)**당 과금 | 실행 수, 기간, 메모리 사용량에 따라 과금 |
| **실행 기록** | 전체 실행 기록 보관 (시각적 확인) | CloudWatch Logs를 통해 확인 가능 |
| **주요 용도** | 결제 처리, 사람 승인 단계 필요 시 | 대용량 메시징, 마이크로서비스 오케스트레이션 |

---

## 5. 익스프레스 워크플로의 실행 모드

* **동기식(Synchronous)**: 워크플로가 끝날 때까지 기다렸다가 결과를 반환합니다. (API Gateway와 연결 시 유용)
* **비동기식(Asynchronous)**: 시작되었음을 확인하면 즉시 응답하며, 결과는 나중에 별도로 확인해야 합니다.

---

## 6. 오류 처리 및 모범 사례

* **Retry**: 특정 단계가 실패했을 때 자동으로 재시도하도록 설정할 수 있습니다.
* **Catch**: 오류 발생 시 특정 경로(예: 오류 처리용 Lambda 또는 SNS 알림)로 흐름을 넘깁니다.
* **모니터링**: 최종 실패 시 **EventBridge**를 통해 감지하고, **SNS**로 관리자에게 알림을 보내는 것이 권장되는 아키텍처 패턴입니다.

---

## 7. 호출 방법 (Triggers)

Step Functions는 다양한 방식으로 시작될 수 있습니다.

* AWS 관리 콘솔 / SDK / CLI
* **API Gateway**: REST API 호출을 통해 동기/비동기 실행.
* **EventBridge**: 특정 이벤트나 일정(Cron)에 따라 트리거.
* **CodePipeline**: 배포 프로세스 중 호출.
* **Step Functions**: 하나의 워크플로가 다른 워크플로를 호출.

## 1. Microsoft Active Directory (AD) 기초 개념

* **정의:** Windows 서버 환경에서 사용자 계정, 컴퓨터, 보안 그룹 등의 객체를 관리하는 **중앙 집중식 데이터베이스**입니다.
* **구조:** 객체들을 그룹화하여 **트리(Tree)**를 형성하며, 이러한 트리들의 집합을 **포리스트(Forest)**라고 부릅니다.
* **핵심 기능:** 한 번의 로그인(John/Password)으로 도메인 내의 모든 연결된 머신에 접근할 수 있게 인증을 동기화합니다.
* **ADFS (AD Federation Services):** 타사 서비스(AWS, Dropbox, Office365 등)에 **SAML** 기반의 **싱글 사인온(SSO)**을 제공하는 서비스입니다.

---

## 2. AWS Directory Service의 3가지 유형

AWS에서 제공하는 관리형 디렉터리 서비스는 용도와 기능에 따라 세 가지로 나뉩니다.

| 구분 | AWS Managed Microsoft AD | AD Connector | Simple AD |
| --- | --- | --- | --- |
| **특징** | 실제 Windows 기반 Microsoft AD | **디렉터리 프록시 (게이트웨이)** | Samba 4 기반 (AD 호환) |
| **사용자 관리** | AWS와 온프레미스 양쪽 가능 | **온프레미스에서만 관리** | AWS 내 독립 실행형 관리 |
| **신뢰 관계** | 온프레미스 AD와 **Trust 설정 가능** | 신뢰 관계 설정 불가 | 설정 불가 |
| **MFA 지원** | 지원함 | 지원함 | **지원 안 함** |
| **RDS SQL 통합** | 지원함 | 지원 안 함 | 지원 안 함 |
| **비용/성능** | 고성능, 대규모 적합 | 연결 전용, 가성비 | 가장 저렴, 소규모(500~5000명) |

---

## 3. AWS Managed Microsoft AD (상세)

가장 강력하고 AWS 서비스와 가장 잘 통합되는 옵션입니다.

### 핵심 특징 및 배포

* **고가용성:** 최소 2개의 가용 영역(AZ)에 도메인 컨트롤러(DC)를 자동 배포합니다. 필요 시 DC를 추가하여 확장 가능합니다.
* **무결절성 도메인 조인:** EC2 인스턴스를 도메인에 자동으로 조인시킬 수 있습니다.
* **통합 서비스:** RDS(SQL Server), WorkSpaces, QuickSight, SSO 등과 완벽하게 통합됩니다.
* **다중 리전 복제:** 자동화된 리전 간 복제를 지원합니다.

### 온프레미스 AD와의 연결 (신뢰 관계)

시험에서 가장 자주 출현하는 포인트입니다. **복제(Replication)가 아니라 신뢰(Trust) 설정**이라는 점이 핵심입니다.

* **연결 방법:** Direct Connect(DX) 또는 VPN이 반드시 필요합니다.
* **신뢰 유형:**
1. **단방향 신뢰:** AWS가 온프레미스를 신뢰하거나, 그 반대인 경우.
2. **양방향 포리스트 신뢰:** 양쪽 사용자가 서로의 자원에 액세스 가능.


* **중요:** 사용자가 동기화되는 것이 아니라, 인증 요청이 왔을 때 상대방 DC에 "이 사용자 맞아?"라고 물어보는 방식입니다.

---

## 4. AD Connector (프록시 모드)

* **작동 방식:** AWS 내부에 사용자 정보를 저장하지 않습니다. 사용자가 로그인을 시도하면 요청을 온프레미스 AD로 전달(Proxy)만 합니다.
* **인증 흐름:**
1. 사용자가 로그인 페이지에 접속.
2. AD Connector가 온프레미스 AD로 LDAP 인증 요청 전달.
3. 인증 성공 시 IAM에서 STS(AssumeRole)를 통해 임시 자격 증명을 받아 사용자에게 부여.


* **단점:** 온프레미스 연결(DX/VPN)이 끊어지면 AWS 로그인이 불가능합니다.

---

## 5. 아키텍처 전략: 지연 시간 최소화 및 재해 복구

네트워크 장애 시에도 로그인을 보장하고 지연 시간을 줄여야 할 때 사용하는 고급 전략입니다.

1. **EC2 기반 복제본 설치:** AWS VPC 내의 **EC2(Windows)** 인스턴스에 온프레미스 AD의 복제본(Additional DC)을 직접 설치합니다.
2. **AWS Managed AD와 신뢰 설정:** 설치된 EC2 AD와 AWS Managed AD 사이에 **양방향 포리스트 신뢰**를 구성합니다.
3. **결과:** VPN이 끊겨도 AWS 내에 복제본(EC2)이 있어 인증이 유지되며, 지연 시간도 최소화됩니다.

---

## 💡 시험 대비 요약

* **완벽한 통합과 MFA, SQL Server 연동이 필요하다?** → **Managed Microsoft AD**
* **사용자 관리는 온프레미스에서만 하고 싶고, 단순 전달만 필요하다?** → **AD Connector**
* **싸고 간단한 AD 호환 서비스가 필요하다(MFA/신뢰 필요 없음)?** → **Simple AD**
* **신뢰(Trust) vs 복제(Sync)?** → Managed AD는 기본적으로 신뢰 관계를 이용하며, 데이터 동기화와는 다릅니다.

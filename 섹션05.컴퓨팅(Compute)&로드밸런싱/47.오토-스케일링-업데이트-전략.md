## 🏗️ 개요: ASG 업데이트의 핵심

애플리케이션을 업데이트하려면 새로운 **시작 템플릿(Launch Template)**이 필요합니다. 단순히 템플릿을 바꾸는 것을 넘어, 아키텍처 관점에서 트래픽을 어떻게 전환하고 어떤 영향을 미치는지 결정하는 것이 솔루션즈 아키텍트의 역할입니다.

---

## 1. 옵션 A: 동일 ASG 내 인스턴스 교체 (용량 확대 방식)

가장 기본적인 방법으로, 기존 오토 스케일링 그룹을 그대로 유지하면서 업데이트를 진행합니다.

* **동작 방식:** 1. 새로운 시작 템플릿(v2)을 생성합니다.
2. ASG의 희망 용량(Desired Capacity)을 **2배**로 늘려 v2 인스턴스들을 생성합니다.
3. **동일한 대상 그룹(Target Group)**에 v1, v2 인스턴스가 공존하게 됩니다.
4. ALB는 v1과 v2 모두에 트래픽을 동시에 보냅니다.
5. v2가 정상 작동하면 v1 인스턴스들을 종료하고 용량을 원복합니다.
* **특징:**
* 구조가 단순합니다.
* **주의점:** ALB가 모든 버전으로 트래픽을 분산하므로, 사용자에게 v1과 v2 응답이 무작위로 섞여 나갈 수 있습니다.



---

## 2. 옵션 B: 새로운 ASG 및 대상 그룹 활용 (ALB 레벨 가중치 제어)

두 개의 ASG와 두 개의 대상 그룹을 사용하는 방식입니다.

* **동작 방식:**
1. 새로운 시작 템플릿 v2를 가진 **새로운 ASG**와 **새로운 대상 그룹**을 생성합니다.
2. **ALB(Application Load Balancer) 레벨**에서 두 대상 그룹 간의 트래픽 비율을 조정합니다.
3. 소량의 트래픽(예: 10%)만 v2로 보내 테스트를 수행합니다.
4. 문제가 없으면 점진적으로 v2의 비중을 높이고 v1 비중을 낮춥니다.


* **장점:**
* **클라이언트 캐싱 문제 없음:** 클라이언트는 동일한 ALB 주소만 바라보므로 DNS 변경이 필요 없습니다.
* **정밀한 제어:** ALB가 트래픽 전환의 주체가 되어 안정적인 카나리(Canary) 배포가 가능합니다.



---

## 3. 옵션 C: 완전 독립된 스택 구성 (Route 53 레벨 제어)

ALB부터 ASG까지 전체 인프라 스택을 하나 더 만드는 가장 분리된 방식입니다.

* **동작 방식:**
1. 새로운 ALB + 새로운 ASG + v2 템플릿으로 구성된 **완전히 독립적인 환경**을 구축합니다.
2. **Route 53(DNS)**에서 가중치 기반 레코드(Weighted Routing)를 설정합니다.
3. DNS 쿼리 결과에 따라 클라이언트를 ALB 1 또는 ALB 2로 분산시킵니다.


* **장점:**
* **완전한 격리:** 서비스 투입 전, 새로운 ALB 주소로 직접 접속하여 별도의 로드 테스트 및 수동 테스트가 가능합니다.


* **단점 및 고려사항:**
* **DNS 의존성:** 클라이언트가 DNS TTL(Time To Live)을 준수하지 않거나 캐싱하고 있으면 전환이 매우 느릴 수 있습니다.
* 마이그레이션 속도를 제어하기 어렵고 클라이언트의 동작 방식에 영향을 받습니다.



---

## 💡 결론: 아키텍트의 선택 기준

AWS SAP 시험에서는 "무엇이 정답인가"보다 **"요구 사항에 가장 부합하는 것이 무엇인가"**를 묻습니다.

| 비교 항목 | 옵션 A (동일 ASG) | 옵션 B (ALB 가중치) | 옵션 C (Route 53 가중치) |
| --- | --- | --- | --- |
| **복잡도** | 낮음 | 중간 | 높음 |
| **제어 주체** | ASG 설정 | ALB 리스너 규칙 | Route 53 DNS 레코드 |
| **주요 특징** | 가장 빠르고 간단함 | 클라이언트 영향 최소화 | 환경 간 완전 격리 및 사전 테스트 |

## 1. 사용 계획(Usage Plans) 및 API 키

API를 외부 고객에게 제공할 때 액세스를 제어하고 사용량을 측정하기 위한 기능입니다.

* **사용 계획 (Usage Plans):**
  * **정의:** 특정 API 스테이지 및 메서드에 대해 누가, 얼마나 빠르게, 어느 정도까지 액세스할 수 있는지 정의합니다.
  * **스로틀링(Throttling):** 요청 속도 제한 (예: 초당 요청 수).
  * **쿼터(Quota):** 특정 기간(일, 주, 월) 동안의 최대 요청 총량 제한.

* **API 키 (API Keys):**
  * 알파벳과 숫자로 구성된 고유 문자열로 클라이언트를 식별합니다.
  * 사용 계획과 결합하여 클라이언트별로 **액세스를 계량하고 측정**하는 데 사용됩니다.

* **오류 처리 (429 Too Many Requests):**
  * **원인:** 리전 내 모든 API에 걸친 계정 수준의 스로틀링 한도 초과 시 발생합니다.
  * **해결책:** 클라이언트 측에서 **재시도 메커니즘**과 **지수 백오프(Exponential Backoff)** 알고리즘을 구현해야 합니다.



---

## 2. WebSocket API

사용자의 브라우저와 서버 간의 **양방향 대화형 커뮤니케이션**을 지원하며, 상태 유지(Stateful) 애플리케이션에 적합합니다.

* **주요 활용 사례:** 채팅 앱, 협업 플랫폼, 멀티플레이어 게임, 금융 거래 플랫폼 등 실시간 애플리케이션.
* **동작 방식 (람다 및 DynamoDB 연동):**
  1. **onConnect:** 클라이언트 접속 시 호출, 연결 정보(`connectionId`)를 DynamoDB에 저장.
  2. **sendMessage:** 메시지 전송 및 비즈니스 로직 처리.
  3. **onDisconnect:** 연결 해제 시 호출, 관련 데이터 정리.

* **양방향 통신 메커니즘 (@connections):**
  * API Gateway는 각 연결에 대해 고유한 콜백 URL을 제공합니다.
  * 서버(Lambda)가 `/@connections/{connectionId}` URL로 데이터를 게시(Post)하면, API Gateway가 해당 특정 클라이언트에게 메시지를 푸시합니다.



---

## 3. 프라이빗 API (Private APIs)

VPC 내부에서만 액세스할 수 있도록 보안을 강화한 API 형태입니다.

* **연결 방식:**
  * **인터페이스 VPC 엔드포인트(Interface Endpoints):** 이를 통해 VPC 내의 EC2 인스턴스 등이 퍼블릭 인터넷을 거치지 않고 API에 접속합니다.

* **보안 계층 (2단계 제어):**
  1. **VPC 엔드포인트 정책:** 엔드포인트 자체에 대한 액세스 권한 제어.
  2. **API Gateway 리소스 정책:**
     * 특정 VPC(`aws:SourceVpc`) 또는 특정 엔드포인트(`aws:SourceVpce`)에서 오는 요청만 허용/거부.
     * 교차 계정(Cross-account) 액세스 제어 가능.
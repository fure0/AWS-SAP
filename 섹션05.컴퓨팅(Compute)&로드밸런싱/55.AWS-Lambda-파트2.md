## 1. Lambda와 VPC (네트워크 아키텍처)

Lambda 함수는 기본적으로 AWS 소유의 퍼블릭 네트워크에 배포되지만, 필요에 따라 사용자의 VPC 내에 배치할 수 있습니다.

### **기본 Lambda (Non-VPC)**

* **특징:** AWS Cloud의 퍼블릭 네트워크에 배포됨.
* **액세스:** 인터넷 및 DynamoDB 같은 퍼블릭 API에 즉시 액세스 가능.
* **제한:** 사용자의 프라이빗 VPC 내에 있는 RDS 등에는 접근 불가.

### **VPC 내부의 Lambda**

* **목적:** 프라이빗 서브넷 내의 리소스(RDS 등)에 안전하게 접근하기 위함.
* **설정:** 보안 그룹(Security Group)이 할당되며 VPC 내부에 배포됨.
* **인터넷 연결 문제:** VPC 내에 배포된 Lambda는 **퍼블릭 서브넷에 있더라도 기본적으로 인터넷에 직접 나갈 수 없습니다.**
* **해결책 (인터넷/퍼블릭 API 접근):**
  1. **NAT Gateway/Instance:** 프라이빗 서브넷의 Lambda가 NAT 기기를 거쳐 인터넷 게이트웨이(IGW)를 통해 밖으로 나감.
  2. **VPC Endpoint:** DynamoDB 등 퍼블릭 서비스 접근 시, 트래픽을 내부 네트워크에 유지하며 직접 연결.


* **참고:** NAT가 없어도 CloudWatch Logs는 서비스 내장 기능이므로 정상 작동합니다.

---

## 2. 고정 IP가 필요한 경우 (Network Security)

API 필터링이나 보안 강화 등의 이유로 Lambda의 출구 IP를 고정해야 할 때가 있습니다.

* **기본 상태:** AWS 퍼블릭 클라우드에서 실행 시 랜덤한 퍼블릭 IP를 할당받음. (화이트리스트 보안 처리가 어려움)
* **고정 IP 구현 방법:**
  1. Lambda를 **프라이빗 서브넷**에 배포.
  2. **NAT Gateway**를 설정하고, 여기에 **고정된 탄력적 IP(EIP)**를 할당.
  3. 모든 Lambda 트래픽이 NAT Gateway를 거치며 동일한 EIP를 가지게 됨.


* **결과:** 외부 API 단에서 특정 EIP만 허용하는 네트워크 보안 설정이 가능해짐.

---

## 3. Lambda 호출 방식: 동기(Synchronous) vs 비동기(Asynchronous)

### **동기 호출 (Synchronous)**

* **호출원:** CLI, SDK, API Gateway 등.
* **특징:** 결과를 즉시 리턴받거나 작업 완료 시까지 대기.
* **오류 처리:** **클라이언트 측**에서 책임짐 (재시도 로직, 지수 백오프 구현 등).

### **비동기 호출 (Asynchronous)**

* **호출원:** S3, SNS, EventBridge 등.
* **특징:** 이벤트를 큐에 쌓고 즉시 리턴(202 Accept). Lambda가 내부적으로 알아서 실행함.
* **오류 처리:** Lambda 서비스가 **최대 3회 재시도**를 수행.
* **주의사항:** 재시도로 인해 함수가 여러 번 실행될 수 있으므로 **멱등성(Idempotency)** 보장이 필수.
* **실패 관리:** 최종 실패 시 이벤트를 보관할 **DLQ(Dead Letter Queue)** 정의 가능 (SNS 또는 SQS 사용).

---

## 4. Lambda 아키텍처 비교 (S3 이벤트 처리 예시)

두 아키텍처는 비슷해 보이지만 성능과 안정성 면에서 큰 차이가 있습니다.

| 비교 항목 | **S3 → SNS → Lambda** | **S3 → SNS → SQS → Lambda** |
| --- | --- | --- |
| **속도 (즉각성)** | **매우 빠름.** 즉시 트리거됨. | **약간의 지연.** 대기열을 거쳐 소비됨. |
| **확장성** | 대량 업로드 시 병렬 실행 폭증. | SQS가 완충 작용을 하며 순차적/배치 처리. |
| **안정성** | 실패 시 데이터 유실 위험 (DLQ 필요). | 실패해도 메시지가 **SQS에 저장**되어 안전함. |
| **효율성** | 파일당 1개 함수 실행. | **배치 처리(예: 10개씩)** 가능하여 효율적임. |

> **핵심 요약:**
> 즉각적인 병렬 처리가 중요하다면 첫 번째 방식을, 처리 지연이 있더라도 데이터 유실 방지와 효율적인 부하 관리가 중요하다면 두 번째(SQS 도입) 방식을 선택해야 합니다.

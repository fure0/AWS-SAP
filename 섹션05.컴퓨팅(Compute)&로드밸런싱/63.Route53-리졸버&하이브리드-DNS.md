## 1. 하이브리드 DNS의 필요성

기본적으로 **Route 53 Resolver**는 VPC 내부의 로컬 도메인, 프라이빗 호스팅 영역, 그리고 인터넷의 퍼블릭 도메인에 대한 쿼리에 응답합니다. 하지만 다음과 같은 **하이브리드 환경**에서는 추가 설정이 필요합니다.

* **대상:** 피어링된 VPC, Direct Connect 또는 VPN으로 연결된 **온프레미스 네트워크**.
* **목적:** AWS와 외부 네트워크 간의 상호 도메인 이름 해석(Name Resolution).

---

## 2. 리졸버 엔드포인트 (Resolver Endpoints)

하이브리드 DNS 구현의 핵심은 두 가지 엔드포인트입니다.

### **① 인바운드 엔드포인트 (Inbound Endpoint)**

* **방향:** 외부 네트워크(온프레미스) → AWS
* **역할:** 외부 DNS 리졸버가 AWS의 Route 53 리졸버로 쿼리를 보낼 수 있게 함.
* **특징:**
  * AWS 리소스(EC2 내부 이름, 프라이빗 호스팅 영역 레코드)를 외부에서 조회 가능.
  * 고가용성을 위해 2개 이상의 가용 영역(AZ)에 **ENI(탄력적 네트워크 인터페이스)**를 생성.
  * 온프레미스 DNS에서 "특정 도메인(예: `aws.private`)은 이 ENI IP로 물어봐라"고 설정(조건부 전달).

### **② 아웃바운드 엔드포인트 (Outbound Endpoint)**

* **방향:** AWS → 외부 네트워크(온프레미스)
* **역할:** VPC 내부의 쿼리를 선택적으로 온프레미스 DNS 리졸버로 전달.
* **특징:**
  * 온프레미스 전용 도메인(예: `onprem.private`)을 AWS에서 조회 가능.
  * **리졸버 규칙(Resolver Rules)**을 생성하여 특정 도메인 쿼리를 외부 IP로 포워딩.



---

## 3. 리졸버 규칙 (Resolver Rules)

아웃바운드 트래픽을 제어하기 위해 사용되는 규칙들입니다.

| 규칙 유형 | 설명 |
| --- | --- |
| **조건부 전달 (Forward)** | 특정 도메인(예: `example.com`) 요청을 지정한 타겟 IP(온프레미스 DNS)로 전달. |
| **시스템 규칙 (System)** | 특정 하위 도메인에 대해 전달 규칙을 무시하고 Route 53이 직접 리졸빙하도록 오버라이드. |
| **자동 정의 규칙** | `ec2.internal` 등 AWS 내부 도메인을 위해 자동으로 생성되는 기본 규칙. |

> **[핵심 원칙] 가장 구체적인 매치(Most Specific Match):** 여러 규칙이 경합할 경우, 가장 상세하게 일치하는 규칙이 우선 적용됩니다.

---

## 4. 인프라 및 관리 최적화

* **성능:** 엔드포인트의 IP 주소당 **초당 약 10,000회**의 쿼리를 지원합니다. (필요 시 IP 추가로 확장 가능)
* **관리 편의성:** 과거처럼 직접 DNS 서버를 구축/관리할 필요 없이 AWS 관리형 서비스를 이용합니다.
* **중앙 집중 관리 (AWS RAM 활용):**
  * **AWS Resource Access Manager(RAM)**를 통해 리졸버 규칙을 여러 계정과 공유 가능.
  * 하나의 중앙 전용 계정에서 모든 규칙을 관리하고, 다수의 VPC가 이를 참조하여 일관된 DNS 정책 유지.



---

## 요약: 시험 포인트

1. **인바운드:** 온프레미스에서 AWS 도메인을 찾을 때 (외부 → 내부).
2. **아웃바운드:** AWS에서 온프레미스 도메인을 찾을 때 (내부 → 외부).
3. **고가용성:** 최소 2개의 AZ에 엔드포인트 배치 필수.
4. **공유:** RAM을 통한 멀티 계정 환경에서의 규칙 공유.

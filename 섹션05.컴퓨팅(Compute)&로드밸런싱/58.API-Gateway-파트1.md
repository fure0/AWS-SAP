## 1. Amazon API Gateway 개요

API Gateway는 클라이언트에게 REST API를 노출하는 관리형 서비스로, 주로 Lambda와 결합하여 서버리스 아키텍처의 관문 역할을 합니다.

* **주요 기능:**
* **노출 대상:** Lambda 함수, HTTP 엔드포인트, 기타 AWS 서비스 직접 노출.
* **버저닝:** 여러 버전의 API를 게시하여 클라이언트의 단계적 마이그레이션 지원.
* **보안:** 권한 부여 및 인증 통합.
* **트래픽 관리:** API 키 설정, 사용량 계획(Usage Plans) 및 스로틀링(Throttling).
* **변환:** 요청 및 응답 데이터의 형식을 비즈니스 로직에 맞게 변환.
* **OpenAPI 지원:** OpenAPI 스펙으로 API 정의 및 클라이언트 라이브러리 자동 생성.



---

## 2. 반드시 기억해야 할 성능 제한 (Critical Limits)

솔루션 아키텍처 설계 시 가장 먼저 고려해야 할 제약 사항입니다.

| 항목 | 제한 수치 | 비고 |
| --- | --- | --- |
| **최대 시간 초과** | **29초** | Lambda 제한(15분)보다 짧음. 긴 작업은 비동기 처리 필요. |
| **페이로드 크기** | **10MB** | 큰 파일 업로드 시 API Gateway 직접 통신은 부적합. |

---

## 3. 파일 업로드 아키텍처 비교

10MB 제한을 극복하기 위한 설계 전략입니다.

### 패턴 A: API Gateway를 통한 직접 업로드 (비권장)

* **흐름:** 클라이언트 → API Gateway → S3 `PutObject`
* **한계:** 10MB 이상의 파일은 업로드 불가능.

### 패턴 B: Pre-signed URL 활용 (권장)

1. **클라이언트**가 API Gateway를 통해 **Lambda**를 호출.
2. **Lambda**는 S3 SDK를 사용하여 **Pre-signed URL(미리 서명된 URL)**을 생성 후 반환.
3. **클라이언트**는 해당 URL을 사용하여 **S3에 직접 파일을 업로드**.

* **장점:** API Gateway의 페이로드 제한을 우회하며, 대용량 파일 업로드 가능.

---

## 4. 엔드포인트 유형 및 캐싱

### 엔드포인트 종류

* **엣지 최적화 (Edge-Optimized):** CloudFront를 거쳐 전 세계 클라이언트 지연 시간 최소화 (기본값).
* **리전 (Regional):** 특정 리전 내 클라이언트를 위함. 수동으로 CloudFront와 조합 가능.
* **프라이빗 (Private):** VPC 내에서만 액세스 가능 (Interface VPC Endpoint 사용).

### 응답 캐싱 (Caching)

* **목적:** 백엔드(Lambda 등) 호출 횟수 감소 및 응답 속도 향상.
* **TTL:** 기본 300초 (최소 0초 ~ 최대 3600초).
* **제어:** 단계(Stage)별 설정 가능, 특정 메서드별 재정의 가능.
* **무효화:** 클라이언트가 `Cache-Control: max-age=0` 헤더 사용 가능 (IAM 권한 필요).

---

## 5. 오류 코드 (Troubleshooting)

* **4xx (클라이언트 오류):**
* `400`: 잘못된 요청 (Bad Request)
* `403`: 권한 거부 또는 WAF 차단
* `429`: 할당량 초과 (Throttling)


* **5xx (서버 오류):**
* `502`: Bad Gateway (Lambda 반환값 형식이 틀렸거나 부하가 높을 때)
* `503`: 서비스 이용 불가 (백엔드 응답 불가)
* `504`: **통합 시간 초과 (Integration Timeout)** → 29초 초과 시 발생



---

## 6. 보안 및 인증 전략

* **리소스 정책:** IP, CIDR, VPC 엔드포인트 기반 액세스 제어.
* **CORS:** 브라우저 기반 보안 조치 및 도메인 제어.
* **인증 3종 세트:**
1. **IAM 인증:** Sig V4를 통한 자격 증명 (내부 인프라용).
2. **Lambda 권한 부여자 (Authorizer):** OAuth, SAML 등 외부 인증 토큰 검증 로직 구현.
3. **Cognito 사용자 풀:** Cognito와 심층 통합하여 토큰 기반 자동 인증.



---

## 7. 모니터링 및 로깅

* **CloudWatch Logs:** 상세 요청/응답 데이터 로깅 (Error/Info 레벨).
* **Kinesis Data Firehose:** 로그를 실시간으로 스트리밍하여 분석 도구로 전송.
* **CloudWatch Metrics:** `Latency`, `CacheHitCount`, `CacheMissCount` 등 지표 분석.
* **AWS X-Ray:** 전체 요청의 흐름과 지연 시간 추적 (Tracing).

---

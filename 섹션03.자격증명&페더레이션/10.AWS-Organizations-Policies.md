# ☁️ AWS Organizations 정책 및 보안 제어 총정리

## 1. 서비스 제어 정책 (SCP, Service Control Policies)

SCP는 조직(Organizations) 내 계정들의 권한을 중앙에서 제어하는 **가장 강력한 가드레일**입니다.

### 📌 핵심 특징

* **적용 범위:** OU(조직 단위) 또는 개별 계정에 적용. **모든 사용자, 역할, 루트 사용자**에게 적용됨.
* **관리 계정의 예외:** 관리 계정(Management Account)에 설정된 SCP는 무시됩니다. (Self-Lockout 방지)
* **서비스 연결 역할(SLR) 예외:** AWS 서비스 간 통합을 위한 역할은 SCP의 영향을 받지 않습니다.
* **상속 및 허용 원리:** 루트 -> OU -> 계정으로 이어지는 모든 단계에서 **명시적 허용(Explicit Allow)**이 있어야 권한이 활성화됩니다.
* **우선순위:** 명시적 거부(Deny)는 모든 허용(Allow)보다 우선합니다.

### 💡 주요 유즈케이스

* **서비스 비활성화:** PCI 준수 등을 위해 특정 리전이나 특정 서비스(예: EMR) 사용을 금지.
* **리전 제한:** `RequestedRegion` 조건 키를 사용하여 특정 국가/리전 이외의 작업을 차단.
* **태그 강제:** 특정 태그(예: Project, CostCenter)가 없는 자원 생성을 차단.

---

## 2. IAM 정책 평가 로직 (Evaluation Logic)

AWS에서 요청이 들어오면 다음 순서에 따라 최종 승인 여부를 결정합니다. 하나라도 **명시적 거부**가 있으면 최종 결과는 **거부**입니다.

1. **명시적 거부 확인:** 어디든 Deny가 있으면 즉시 종료.
2. **SCP 확인:** 조직 레벨의 가드레일 확인.
3. **리소스 기반 정책:** S3 Bucket, SQS 등의 정책 확인.
4. **IAM 권한 경계(Permissions Boundary):** 개별 ID가 가질 수 있는 최대 권한 확인.
5. **ID 기반 정책:** IAM User/Role에 직접 연결된 정책 확인.
6. **세션 정책:** STS 세션 등에 적용된 임시 정책 확인.

---

## 3. 조건 키를 활용한 태그 제어 (Tagging)

리소스 관리 및 비용 최적화를 위해 정책에서 태그를 검증할 수 있습니다.

### IAM 정책의 태그 조건

* **`ForAllValues`:** 요청된 모든 태그 키가 정책에 명시된 키와 일치해야 함.
* **`ForAnyValue`:** 나열된 태그 중 하나라도 포함되어 있으면 허용.
* **`Null` 조건:** 특정 태그가 누락되었는지를 체크하여 리소스 생성을 거부할 때 사용.

### 태그 정책 (Tag Policies)

* **표준화:** 조직 전체의 태그 키와 허용된 값을 정의 (예: CostCenter는 100 또는 200만 가능).
* **준수 여부 감사:** 비준수 리소스를 나열하는 보고서를 생성하거나 EventBridge로 실시간 감지.

---

## 4. 기타 조직 정책 (AI & Backup)

### 🤖 AI 서비스 선택 해제 정책 (AI Opt-out Policies)

* **목적:** AWS가 서비스 개선을 위해 고객 데이터를 학습용으로 저장하는 것을 방지.
* **적용:** 특정 서비스(Amazon Lex, Rekognition 등) 또는 전체 서비스에 대해 데이터 수집 거부 설정.

### 💾 백업 정책 (Backup Policies)

* **중앙 관리:** AWS Backup을 사용하여 조직 전체의 백업 계획(빈도, 보관 기간, 리전 등)을 정의.
* **불변성:** 멤버 계정에서는 이 정책을 **읽기 전용**으로만 볼 수 있으며, 수정은 관리 계정에서만 가능함.

---

### 📝 요약 테이블

| 정책 유형 | 주요 용도 | 비고 |
| --- | --- | --- |
| **SCP** | 조직 내 최대 권한 가드레일 설정 | 루트 사용자에게도 적용됨 |
| **태그 정책** | 리소스 태그의 키/값 표준화 | 비용 할당 및 거버넌스 목적 |
| **AI 옵트아웃** | AWS AI 서비스의 데이터 사용 거부 | 데이터 프라이버시 보호 |
| **백업 정책** | 중앙 집중식 백업 일정 관리 | 멤버 계정은 수정 불가 |

## 1. IAM 기본 구성 요소와 자격 증명 (Credentials)

IAM은 AWS 리소스에 대한 접근을 제어하며, 크게 장기 자격 증명과 단기 자격 증명으로 나뉩니다.

* **사용자 및 그룹:** 사용자에게 부여되는 **장기 자격 증명**입니다.
* **역할 (Roles):** **단기 자격 증명**을 생성합니다. **STS(Security Token Service)**를 통해 일시적인 권한을 부여받습니다.
* **EC2 인스턴스 역할:** 인스턴스 메타데이터 서비스를 통해 S3, DynamoDB 등에 접근할 수 있는 권한을 부여합니다.
* **서비스 역할:** API Gateway, Lambda, CodeDeploy 등 AWS 서비스가 타 서비스를 조작할 수 있도록 권한을 위임합니다.
* **교차 계정 역할 (Cross-Account Role):** 한 계정에서 다른 계정의 리소스에 접근할 때 사용합니다. 자격 증명을 직접 공유하지 않고 역할을 인수(Assume)하는 방식입니다.



---

## 2. IAM 정책 (Policy) 종류

정책은 JSON 문서 형식으로 작성되며, 누가 무엇을 할 수 있는지 정의합니다.

| 정책 유형 | 특징 |
| --- | --- |
| **AWS 관리형 정책** | AWS가 생성/관리. 범용적이지만 시간이 지나면 내용이 변경될 수 있음. |
| **고객 관리형 정책** | 사용자가 직접 생성 및 관리. 재사용 가능하며 버전 관리가 가능함. |
| **인라인 정책** | 특정 사용자/역할에 1:1로 직접 포함됨. 다른 개체와 공유 불가. |
| **리소스 기반 정책** | S3 버킷, SQS 대기열 등 **리소스 자체에 부착**하는 정책. |

---

## 3. JSON 정책 구조 및 평가 원리

정책은 문장(Statement)으로 구성되며 다음 요소를 포함합니다.

* **Effect:** Allow(허용) 또는 Deny(거부)
* **Action:** 실행하고자 하는 특정 작업 (예: `ec2:RunInstances`)
* **Resource:** 작업 대상 리소스 (ARN 형식)
* **Condition:** 정책이 효력을 발휘하기 위한 조건 (예: 특정 태그가 있는 경우만 허용)

> **[정책 평가의 핵심 법칙]**
> 1. **기본값은 Deny:** 명시적으로 허용되지 않으면 거부됩니다.
> 2. **Explicit Deny(명시적 거부)가 항상 우선:** 아무리 많은 Allow가 있어도 하나라도 Deny가 있으면 최종 결과는 거부입니다.
> 
> 

---

## 4. 보안 및 분석 도구

최소 권한의 원칙(Least Privilege)을 실현하기 위한 도구입니다.

* **IAM Access Advisor:** 부여된 권한 중 실제 사용된 시점을 확인합니다. 오랫동안 사용하지 않은 권한을 삭제하는 데 유용합니다.
* **IAM Access Analyzer:** 리소스(S3 등)가 외부 엔티티와 공유되고 있는지 분석하여 불필요한 외부 노출을 차단합니다.

---

## 5. 고급 정책 테크닉: NotAction & Condition

### NotAction의 활용

`Deny`와 특정 `Action`을 조합하면 의도치 않게 모든 권한이 막힐 수 있습니다. 이때 `NotAction`을 사용하면 **"이 작업들을 제외한 모든 것을 허용/거부"**하는 정교한 설정이 가능합니다. (예: PowerUserAccess 설정 시 유용)

### Condition Operators (조건 연산자)

* **String:** 문자열 비교 (예: `PrincipalTag`)
* **Numeric:** 숫자 비교 (이하, 이상 등)
* **Date:** 날짜 비교 (일시적 액세스 권한 부여 시 사용)
* **Boolean:** SSL 사용 여부(`SecureTransport`), MFA 인증 여부 확인
* **IP Address:** 특정 CIDR 블록 내의 소스 IP만 허용

### 정책 변수 (Policy Variables)

`${aws:username}`과 같은 변수를 사용하면 정책 하나로 여러 사용자에게 동적 권한을 줄 수 있습니다.

* **예시:** S3 버킷 내에서 각자의 이름으로 된 폴더만 접근 가능하게 설정.

---

## 6. IAM 역할 vs 리소스 기반 정책 (중요!)

교차 계정 접근 시 두 방식의 결정적인 차이점을 이해해야 합니다.

1. **역할 인수 (Assuming a Role):**
   * 사용자는 **기존 계정의 권한을 일시적으로 포기**하고, 대상 계정의 역할 권한만 가집니다.
2. **리소스 기반 정책 (Resource-based Policy):**
   * 사용자는 **자신의 기존 권한을 유지**하면서, 타 계정의 특정 리소스에 추가로 접근할 수 있습니다.
   * *예시:* 내 계정의 DynamoDB를 읽으면서(자격 증명 권한), 동시에 다른 계정의 S3에 쓰기 작업을 수행(리소스 기반 정책)해야 할 때 적합합니다.



---

## 7. IAM 권한 경계 (Permission Boundary)

사용자나 역할에 대해 **허용할 수 있는 최대 권한 영역**을 설정하는 기능입니다.

* **동작 방식:** 자격 증명 기반 정책과 권한 경계의 **교집합(중첩 영역)**만 유효한 권한이 됩니다.
* **활용 사례:**
  * 관리자가 개발자에게 "IAM 역할 생성 권한"을 주되, 개발자가 관리자 권한을 스스로 부여하지 못하도록 최대 권한을 제한할 때 사용합니다.
  * SCP(Service Control Policy)와 유사하게 작동하지만, 계정 전체가 아닌 특정 사용자/역할 단위로 세밀하게 제어할 때 유리합니다.



---

# 📦 Amazon ECS 및 컨테이너 생태계 완벽 정리

## 1. 도커(Docker) 기초 이해

도커는 ECS의 근간이 되는 소프트웨어 개발 및 배포 플랫폼입니다.

* **컨테이너화**: 애플리케이션과 실행 환경을 하나로 패키징합니다.
* **일관성**: 운영체제(OS)와 무관하게 어떤 기기에서든 동일하게 작동하여 예측 가능한 결과를 보장합니다.
* **효율성**: 가상 머신(VM)보다 가볍고, 개별 컨테이너 단위로 CPU 및 메모리 리소스를 정밀하게 할당할 수 있습니다.
* **유지보수**: 기술 스택에 상관없이 관리가 쉬우며 확장/축소가 매우 빠릅니다.

---

## 2. AWS 컨테이너 관리 플랫폼

AWS에서 도커 컨테이너를 실행하고 관리하는 주요 서비스입니다.

| 서비스명 | 특징 |
| --- | --- |
| **Amazon ECS** | AWS 전용 자체 컨테이너 오케스트레이션 서비스 |
| **Amazon EKS** | 오픈소스인 Kubernetes(K8s)를 AWS에서 관리형으로 제공 |
| **AWS Fargate** | 서버리스 컨테이너 실행 엔진 (ECS, EKS 모두와 호환) |

---

## 3. Amazon ECS 핵심 개념 및 구성 요소

### 🏗️ 구조적 요소

* **ECS 클러스터 (Cluster)**: EC2 인스턴스들의 논리적인 그룹입니다.
* **태스크 정의 (Task Definition)**: JSON 형식의 설계도로, 어떤 도커 이미지를 쓸지, CPU/RAM은 얼마나 할당할지 정의합니다.
* **태스크 (Task)**: 태스크 정의가 실제로 실행된 상태(컨테이너 인스턴스)입니다.
* **서비스 (Service)**: 클러스터 내에서 특정 개수의 태스크가 항상 실행되도록 유지하고 관리합니다.

### 🔐 IAM 역할 (Security)

1. **EC2 인스턴스 프로파일**: EC2 인스턴스가 ECS 서비스와 통신하고 CloudWatch에 로그를 보내는 권한을 가집니다.
2. **ECS 태스크 IAM 역할**: **개별 태스크(컨테이너)**가 S3, DynamoDB 등 다른 AWS 리소스에 접근할 때 사용하는 권한입니다.

---

## 4. 로드 밸런싱 및 네트워크

### 🔄 ALB 통합 및 동적 포트 매핑 (Dynamic Port Mapping)

* **기능**: 하나의 EC2 인스턴스 내에서 동일한 서비스의 컨테이너를 여러 개 실행할 수 있게 합니다.
* **작동 원리**: 각 컨테이너는 임의의 포트를 할당받지만, **ALB가 이 포트들을 자동으로 감지**하여 트래픽을 올바르게 전달합니다.
* **장점**: 리소스 사용률 극대화, 가용성 향상, 롤링 업데이트 용이.

### 🌐 네트워크 모드 (Network Modes)

* **none**: 네트워크 연결 없음.
* **bridge**: 도커의 가상 네트워크 사용.
* **host**: 호스트(EC2)의 네트워크 인터페이스를 직접 공유.
* **awsvpc**: **(권장)** 각 태스크마다 고유한 **ENI와 프라이빗 IP**를 부여합니다. 보안 그룹 적용 및 모니터링이 쉬우며 Fargate의 기본 모드입니다.

---

## 5. 실행 모델 및 확장성

### 🚀 시작 유형 (Launch Types)

1. **EC2 Launch Type**: 사용자가 직접 EC2 인스턴스를 관리하고 비용을 최적화(예: 스팟 인스턴스 사용)합니다.
2. **Fargate Launch Type (서버리스)**: 인프라 관리가 필요 없습니다. 태스크 단위로 리소스를 지정하면 AWS가 실행을 담당합니다.

### 📈 오토 스케일링 (Service Auto Scaling)

* **방식**: CloudWatch 지표(CPU/RAM)를 기반으로 태스크 개수를 조절합니다.
* **정책**: 대상 추적(Target Tracking), 단계(Step), 예약(Scheduled) 스케일링을 지원합니다.
* **주의**: EC2 유형 사용 시, 태스크뿐만 아니라 기반이 되는 **EC2 ASG(Auto Scaling Group)의 확장**도 반드시 고려해야 합니다.

---

## 6. 이미지 관리 및 비용 최적화

### 🖼️ Amazon ECR (Elastic Container Registry)

* 도커 이미지를 저장하는 프라이빗/퍼블릭 리포지토리입니다.
* IAM을 통해 접근을 제어하며, 이미지 취약성 스캔 및 버전 관리를 지원합니다.

### 💰 비용 최적화 (Spot Instances)

* **ECS Classic**: ASG를 통해 스팟 인스턴스 활용. 인스턴스 중단 시 '드레이닝(Draining)' 모드를 통해 태스크를 안전하게 이전합니다.
* **Fargate**: `FARGATE_SPOT`을 사용하여 온디맨드 대비 저렴한 비용으로 태스크를 실행할 수 있습니다.

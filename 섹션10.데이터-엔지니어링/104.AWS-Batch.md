## 1. AWS Batch 개요

AWS Batch는 도커(Docker) 컨테이너를 기반으로 수천 개의 배치(Batch) 컴퓨팅 작업을 효율적으로 실행하고 관리하는 **완전 관리형 서비스**입니다.

* **컴퓨팅 리소스:** 작업을 실행하기 위해 Fargate 또는 EC2(온디맨드/스팟)를 자동으로 프로비저닝합니다.
* **비용 효율성:** 배치 작업이 실행되는 동안 사용된 리소스(vCPU, 메모리 등)에 대해서만 비용을 지불합니다.
* **확장성:** 작업의 양에 따라 수천 개의 작업을 동시에 실행할 수 있도록 확장됩니다.

---

## 2. 실행 옵션 및 아키텍처

AWS Batch는 크게 두 가지 방식으로 실행 환경을 구성할 수 있습니다.

| 구분 | Fargate (서버리스) | EC2 / 스팟 인스턴스 |
| --- | --- | --- |
| **특징** | 인스턴스 관리 불필요, 완전 서버리스 | 인스턴스 유형 선택 가능, 비용 최적화 유리 |
| **장점** | 운영 오버헤드 최소화 | 스팟 인스턴스 활용 시 비용 대폭 절감 |

### **[이미지 처리 솔루션 아키텍처 예시]**

사용자가 S3에 이미지를 업로드하면 AWS Batch가 썸네일을 생성하는 구조입니다.

1. **S3 업로드 발생**
2. **작업 트리거 (두 가지 옵션):**
   * **Option 1:** S3 이벤트 알림 → Lambda 호출 → AWS SDK를 통해 Batch 작업 시작
   * **Option 2:** S3 이벤트를 **EventBridge**로 푸시 → EventBridge가 직접 AWS Batch 호출 (**추천: 코드 관리 불필요, 필터링 기능 강화**)

3. **작업 실행:** ECR에서 도커 이미지를 풀(Pull)하여 실행
4. **데이터 처리:** S3에서 원본 파일을 가져와 처리 후 결과물을 다시 S3에 저장하고, 메타데이터를 **DynamoDB**에 기록
   * *주의: S3, DynamoDB 등에 접근하기 위한 적절한 **IAM Role** 설정이 필수입니다.*



---

## 3. AWS Lambda vs AWS Batch

시험에서 자주 비교되는 두 서비스의 차이점입니다.

| 항목 | AWS Lambda | AWS Batch |
| --- | --- | --- |
| **실행 시간 제한** | **제한 있음** (최대 15분) | **제한 없음** (장기 실행 가능) |
| **도커 이미지** | Lambda 전용 이미지 필요 | **모든 종류**의 도커 이미지 사용 가능 |
| **디스크 공간** | 제한적인 임시 공간 제공 | EBS, 인스턴스 저장소 등 유연한 구성 |
| **특징** | 완전 서버리스 이벤트 기반 | 대규모 배치 작업 및 유연한 환경 구성 |

---

## 4. 컴퓨팅 환경 (Compute Environments)

### **1) 관리형 컴퓨팅 환경 (Managed)**

AWS가 인스턴스의 용량과 유형을 직접 관리합니다.

* **유연성:** 온디맨드 또는 스팟 인스턴스 선택 가능 (스팟 최대 가격 설정 가능).
* **VPC 연동:** 인스턴스는 프라이빗 서브넷에서 실행될 수 있으며, ECS 서비스 접근을 위해 **NAT Gateway**나 **VPC Endpoint** 설정이 필요합니다.
* **설정:** 최소/최대 vCPU 수를 설정하면 AWS가 최적의 인스턴스(m5, c5 등)를 조합하여 할당합니다.

### **2) 비관리형 컴퓨팅 환경 (Unmanaged)**

* 사용자가 인스턴스 구성, 프로비저닝, 확장을 **직접 제어**합니다.
* 더 많은 관리 책임이 따르며 특정 커스터마이징이 필요할 때 사용합니다.

---

## 5. 고급 기능: 다중 노드 병렬 작업 (Multi-node Parallel)

대규모 고성능 컴퓨팅(**HPC**) 워크로드를 위한 모드입니다.

* **구조:** 하나의 작업을 실행하기 위해 여러 개의 EC2/ECS 인스턴스를 동시에 활용합니다.
* **구성:** 작업을 주도하는 **메인 노드(Main Node)**와 계산을 돕는 **자식 노드(Child Nodes)**로 구성됩니다.
* **제약 사항 및 권장 사항:**
  * **스팟 인스턴스와 호환되지 않음** (온디맨드 사용 필수).
  * **클러스터 배치 그룹(Cluster Placement Group)** 사용 권장: 노드 간 낮은 네트워크 지연 시간과 높은 대역폭을 보장하기 위함입니다.

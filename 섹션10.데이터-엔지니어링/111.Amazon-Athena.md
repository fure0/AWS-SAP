# 📑 Amazon Athena 핵심 정리

## 1. Amazon Athena 개요

Amazon Athena는 **S3에 저장된 데이터를 분석**하기 위한 **서버리스(Serverless) 대화형 쿼리 서비스**입니다.

* **엔진:** 표준 SQL을 사용하는 **Presto** 엔진 기반.
* **특징:**
  * 데이터를 별도의 DB로 로드(Extract/Load)할 필요 없이 **S3에 있는 상태 그대로 직접 쿼리**.
  * 서버리스 서비스로 인프라 프로비저닝이나 관리가 전혀 필요 없음.

* **지원 형식:** CSV, JSON, ORC, Avro, **Parquet**(권장) 등 다양한 데이터 형식 지원.
* **비용 모델:** 쿼리 실행 시 **스캔한 데이터 양(테라바이트당 고정 금액)**에 따라 과금.

---

## 2. 주요 사용 사례 (Use Cases)

Athena는 주로 데이터 분석 및 로그 조회를 위해 사용됩니다.

* **BI 및 보고서:** **Amazon QuickSight**와 연동하여 대시보드 및 시각화 보고서 생성.
* **로그 분석:** AWS 서비스에서 발생하는 다양한 로그 쿼리.
  * VPC Flow Logs, ELB Logs, AWS CloudTrail 등.

* **시험 팁:** "S3에 있는 데이터를 서버리스 SQL 엔진으로 분석해야 한다"는 요구사항이 나오면 즉시 Athena를 떠올리세요.

---

## 3. 성능 개선 및 비용 최적화 (중요 ⭐)

시험에서 자주 다뤄지는 부분으로, 스캔하는 데이터 양을 줄이는 것이 핵심입니다.

### ① 열 지향 데이터 형식(Columnar Data) 사용

* 필요한 컬럼만 읽기 때문에 스캔 데이터 양이 줄어 성능이 향상되고 비용이 절감됩니다.
* **권장 형식:** **Apache Parquet**, **ORC**.
* **팁:** AWS Glue를 사용하여 기존 CSV 데이터를 Parquet로 변환(ETL)할 수 있습니다.

### ② 데이터 압축 (Compression)

* 데이터를 압축하여 S3에서 읽어오는 데이터 크기를 줄입니다 (예: Snappy, Gzip 등).

### ③ 데이터 파티셔닝 (Partitioning)

* S3 경로 구조를 활용해 데이터를 논리적으로 나눕니다. 쿼리 시 불필요한 폴더를 건너뛰고 특정 하위 집합만 스캔합니다.
* **경로 예시:** `s3://bucket/flight-data/year=2026/month=02/day=14/`
* 이렇게 구성하면 특정 날짜 쿼리 시 해당 경로의 데이터만 읽으므로 효율이 극대화됩니다.

### ④ 파일 크기 최적화

* 수많은 작은 파일(Small files)보다는 **적당히 큰 파일(예: 128MB 이상)**이 유리합니다. 파일이 너무 많으면 메타데이터 조회 오버헤드가 발생하여 성능이 저하됩니다.

---

## 4. Athena Federated Query (통합 쿼리)

S3뿐만 아니라 **어디에 있든 데이터를 쿼리**할 수 있는 강력한 기능입니다.

* **작동 원리:** **AWS Lambda**를 '데이터 소스 커넥터'로 사용하여 외부 데이터 소스에 연결합니다.
* **연결 가능 대상:**
  * **AWS 서비스:** DynamoDB, RDS, Redshift, ElastiCache, DocumentDB, CloudWatch Logs 등.
  * **외부/온프레미스:** 타사 데이터베이스나 온프레미스 환경의 DB.


* **특징:** 서로 다른 데이터 소스 간의 **Join(조인)**이나 계산 작업이 가능하며, 쿼리 결과는 다시 S3에 저장할 수 있습니다.

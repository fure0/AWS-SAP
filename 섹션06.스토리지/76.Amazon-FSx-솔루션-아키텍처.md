# ☁️ AWS FSx 솔루션 아키텍처 및 마이그레이션 전략

Amazon FSx를 운영하면서 마주칠 수 있는 가용성 변경, 용량 관리, 성능 최적화(Lustre)에 대한 핵심 가이드입니다.

---

## 1. FSx for Windows: Single-AZ에서 Multi-AZ로 마이그레이션

현재 AWS에서는 기존 Single-AZ 설정을 버튼 하나로 Multi-AZ로 **직접 업그레이드하는 기능을 제공하지 않습니다.** 따라서 다음 두 가지 우회 전략을 사용해야 합니다.

### 방법 A: AWS DataSync 활용 (권장: 가동 시간 극대화)

* **프로세스:**
  1. 새로운 Multi-AZ용 FSx 파일 서버를 생성합니다.
  2. **AWS DataSync**를 사용하여 기존 Single-AZ의 데이터를 신규 서버로 전송합니다.
* **장점:** 데이터 동기화가 백그라운드에서 진행되므로 서비스 **가동 상태(Online)를 유지**할 수 있습니다.
* **단점:** 백그라운드 동기화로 인해 전체 마이그레이션 속도는 느릴 수 있습니다.

### 방법 B: 백업 및 복원 (권장: 빠른 전환)

* **프로세스:**
  1. Single-AZ 서버의 백업(Snapshot)을 생성합니다.
  2. 해당 백업을 기반으로 새로운 Multi-AZ FSx 서버를 복원합니다.
* **장점:** DataSync 설정보다 프로세스가 단순하고 상대적으로 빠릅니다.
* **단점:** 복원 및 전환 과정에서 **다운타임(Downtime)**이 발생합니다.

---

## 2. FSx 볼륨 크기 축소(Scale-down) 전략

FSx는 용량을 늘릴 수는 있지만, **기존 시스템의 용량을 줄이는 것은 불가능**합니다. 또한 백업 복원 시에도 원본과 동일한 크기로만 복원이 가능합니다.

### 용량 축소 프로세스 (예: 2TB → 1TB)

1. 목표로 하는 더 작은 용량(1TB)의 신규 FSx 파일 시스템을 생성합니다.
2. **AWS DataSync**를 연결하여 기존 데이터를 신규 서버로 지속적 마이그레이션합니다.
3. 데이터가 완전히 동기화(패리티 도달)되면 애플리케이션의 엔드포인트를 새 서버로 변경합니다.
4. 기존의 큰 용량 서버를 삭제합니다.

---

## 3. FSx for Lustre: 데이터 지연 로딩 (Lazy Loading)

고성능 컴퓨팅(HPC)을 위한 FSx for Lustre와 S3를 연동할 때 사용하는 매우 효율적인 기능입니다.

### 주요 특징

* **즉각적인 작업 시작:** S3에 페타바이트(PB)급 대량 데이터가 있더라도, Lustre가 전체 데이터를 모두 다운로드할 때까지 기다릴 필요가 없습니다.
* **요청 시 로드:** 클라이언트(애플리케이션)가 특정 데이터 세트를 **실제로 요청하는 순간**에만 S3에서 FSx로 데이터를 가져옵니다.
* **장점:**
  * **비용 절감:** 필요한 데이터만 로드하므로 스토리지 효율이 높습니다.
  * **레이턴시 감소:** 초기 대기 시간 없이 즉시 처리를 시작할 수 있습니다.

* **중복 로드 방지:** 데이터는 한 번만 로드됩니다. 이미 FSx에 로드된 데이터가 변경되지 않았다면 클라이언트가 다시 요청해도 S3에서 중복해서 가져오지 않습니다.

> **💡 핵심 요약**
> S3 버킷이 연결되는 즉시 FSx for Lustre를 실행할 수 있으며, 실제 데이터는 필요할 때만 불러오는 '지연 로딩' 덕분에 매우 경제적이고 빠릅니다.

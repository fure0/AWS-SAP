## 1. CloudTrail + S3 아키텍처: 데이터 보존 및 분석

CloudTrail은 기본적으로 90일간의 이벤트만 기록하므로, 장기 보관과 정밀 분석을 위해 S3와 연동합니다.

* **배달 주기:** 매 5분마다 로그 파일을 S3 버킷에 덤프(Dump).
* **보안 및 암호화:**
* 기본 SSE-S3 외에 **SSE-KMS**를 수동 설정하여 보안 강화 가능.
* **로그 파일 무결성 검증:** S3에 전달된 파일이 수정/조작되지 않았음을 해싱으로 확인.


* **스토리지 관리:**
* **S3 수명 주기(Lifecycle):** 오래된 로그를 S3 IA나 Glacier로 이동시켜 비용 절감.
* **보호 기능:** 버저닝(Versioning), MFA 삭제 방지, **S3 Object Lock**(수정/삭제 원천 차단).


* **이벤트 알림:** 파일 전달 시 S3 Event(SQS, SNS, Lambda 연동) 또는 CloudTrail이 직접 SNS로 알림 가능.

---

## 2. 다중 계정 및 다중 리전 아키텍처

엔터프라이즈 환경에서 여러 계정의 로그를 하나의 보안 계정(Security Account)으로 통합하는 방식입니다.

* **중앙 집중화:** 계정 A, B의 로그를 **중앙 보안 계정의 S3 버킷**으로 전송.
* **권한 설정 (핵심):**
  * **S3 버킷 정책(Bucket Policy):** 타 계정의 CloudTrail이 보안 계정의 S3에 파일을 쓸 수 있도록 허용해야 함.
  * **교차 계정 액세스:** 타 계정에서 로그를 읽어야 할 경우, **Cross-Account Role**을 생성하거나 버킷 정책에서 읽기 권한을 부여.


* **이점:** 관리 계정을 분리함으로써 로그의 무결성을 보호하고 엄격한 접근 제어 가능.

---

## 3. 실시간 경보 및 API 분석: CloudWatch Logs 연동

특정 API 호출(예: 인스턴스 종료)을 감시하고 즉각 대응하기 위한 아키텍처입니다.

* **프로세스:**
1. **CloudTrail** 이벤트를 **CloudWatch Logs**로 스트리밍.
2. **지표 필터(Metric Filter):** 특정 단어(예: `TerminateInstances`)나 패턴 검색.
3. **CloudWatch 경보(Alarm):** 필터링된 횟수가 임계치를 넘으면 트리거.
4. **SNS/Lambda:** 경보 발생 시 담당자 알림 또는 자동화 로직 실행.


* **활용 사례:**
* 특정 사용자의 API 호출 수 집계.
* 비정상적으로 높은 수준의 **API 호출 거부(Access Denied)** 감지 (침입 시도 파악).



---

## 4. 조직 추적 (Organization Trails)

AWS Organizations 환경에서 대규모 계정을 관리할 때 사용합니다.

* **생성 위치:** 반드시 조직의 **관리 계정(Management Account)**에서 생성.
* **작동 방식:** 생성 시 조직 내 모든 멤버 계정의 이벤트가 자동으로 모니터링됨.
* **로그 저장:** 관리 계정의 S3 버킷에 저장되며, 폴더 구조(Prefix)는 각 **계정 ID별로 구분**되어 저장됨.

---

## 5. 반응 속도 및 용도별 최적 솔루션 비교

시험에서 "가장 빠른 대응"이나 "대규모 분석" 등 요구사항에 따라 선택해야 할 서비스가 달라집니다.

| 서비스 | 반응 속도 | 주 용도 |
| --- | --- | --- |
| **EventBridge** | **가장 빠름 (실시간)** | API 호출에 대한 즉각적인 반응 및 자동화 대응 |
| **CloudWatch Logs** | 중간 | 이벤트 발생 빈도 계산, 지표 필터링, 이상 징후 탐지 |
| **Amazon S3** | 느림 (5분 주기) | 로그 장기 보관, 무결성 검증, 대규모 데이터 분석 |

> **주의사항:** CloudTrail 이벤트가 시스템에 전달되는 데는 최대 15분 정도의 지연이 발생할 수 있음을 인지해야 합니다.
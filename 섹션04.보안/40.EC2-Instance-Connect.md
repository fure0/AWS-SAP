## EC2 Instance Connect 및 SendSSHPublicKey 작동 원리

EC2 Instance Connect는 기존의 키 페어 관리 방식보다 보안성이 뛰어난 연결 방식을 제공합니다. 그 핵심은 `SendSSHPublicKey` API를 통한 **일회성 키 푸시** 방식에 있습니다.

### 1. 네트워크 및 보안 설정 (Pre-requisites)

인스턴스에 접속하기 위해 가장 먼저 보안 그룹(Security Group) 설정이 필요합니다.

* **포트:** SSH 접속을 위해 **22번 포트**를 개방합니다.
* **소스(Source):** 보안을 위해 모든 IP가 아닌, **EC2 Instance Connect 서비스의 IP 범위**만 허용합니다.
* 해당 IP 범위는 AWS에서 제공하는 [ip-ranges.json](https://www.google.com/search?q=https://ip-ranges.amazonaws.com/ip-ranges.json) URL을 통해 확인할 수 있습니다.



---

### 2. 내부 작동 프로세스 (Workflow)

사용자가 EC2 Instance Connect를 통해 접속을 시도하면 배후에서 다음과 같은 과정이 순차적으로 일어납니다.

1. **API 호출:** 사용자가 접속을 시작하면 `SendSSHPublicKey` API가 호출됩니다.
2. **퍼블릭 키 업로드:** EC2 Instance Connect 서비스가 사용자의 **SSH 퍼블릭 키(Public Key)**를 대상 EC2 인스턴스의 메타데이터로 일시적으로 푸시합니다.
3. **유효 기간:** 업로드된 키는 **단 60초 동안만 유효**합니다.
4. **인스턴스 접속:** 사용자는 이 60초 안에 퍼블릭 키와 쌍을 이루는 **프라이빗 키(Private Key)**를 사용하여 인스턴스에 SSH로 접속합니다.

---

### 3. 핵심 요약 및 보안 이점

* **단기 자격 증명:** 키가 60초 후에 자동으로 소멸하므로, 인스턴스 내부에 SSH 키를 영구적으로 저장하고 관리할 필요가 없습니다.
* **감사(Auditing):** 모든 `SendSSHPublicKey` API 호출은 **AWS CloudTrail**에 로깅됩니다. 이를 통해 누가, 언제 인스턴스에 접속을 시도했는지 상세히 감사할 수 있습니다.
* **권한 제어:** IAM 정책을 통해 특정 사용자만 이 API를 호출할 수 있도록 정교하게 제어할 수 있습니다.

> **결론:** EC2 Instance Connect는 키 관리의 번거로움을 줄이고, CloudTrail을 통한 추적성과 60초라는 짧은 유효 시간을 통해 강력한 보안을 제공하는 서비스입니다.
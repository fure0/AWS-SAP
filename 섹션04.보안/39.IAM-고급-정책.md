## 🔐 IAM 정책 조건(Condition) 총정리

IAM 정책에서 **Condition** 요소는 정책이 실행되기 위한 구체적인 제약 사항을 정의합니다. 이는 사용자, 리소스, API 호출 환경 등 다양한 변수를 제어하는 강력한 도구입니다.

### 1. 전역 조건 키 (Global Condition Keys)

`aws:`로 시작하는 조건은 모든 서비스에 공통으로 적용될 수 있는 전역 설정입니다.

* **`aws:SourceIp` (IP 제한)**
* **용도:** API 호출이 발생하는 클라이언트의 IP 주소를 제한합니다.
* **활용:** 회사 사내 네트워크(특정 CIDR)에서만 AWS 콘솔이나 CLI에 접속 가능하도록 설정할 때 사용합니다.
* *예시:* `NotIpAddress` 조건과 `Deny` 효과를 조합하여 "지정된 IP가 아니면 모든 접근 거부" 식의 보안 강화가 가능합니다.


* **`aws:RequestedRegion` (리전 제한)**
* **용도:** API 호출이 수행되는 대상 리전을 제한합니다.
* **활용:** 특정 국가/지역의 리전(예: `eu-central-1`) 사용을 금지하거나, SCP(Service Control Policy)와 결합하여 조직 전체의 리전 사용 범위를 규정합니다.


* **`aws:PrincipalTag` (사용자 태그 기반)**
* **용도:** API를 호출하는 **사용자(Principal)**에게 부여된 태그를 검사합니다.
* **활용:** "부서(Department)가 Data인 사용자만 이 작업을 수행할 수 있음"과 같은 속성 기반 액세스 제어(ABAC)를 구현합니다.


* **`aws:MultiFactorAuthPresent` (MFA 강제)**
* **용도:** 다중 인증(MFA)을 거쳤는지 여부를 확인합니다.
* **활용:** 인스턴스 종료(Terminate)나 삭제와 같은 민감한 작업 시, MFA 인증이 된 경우에만 허용하도록 설정합니다.



### 2. 서비스 전용 조건 키 (Service-Specific Keys)

특정 서비스의 리소스 특성에 맞춰 작동하는 조건입니다.

* **`ec2:ResourceTag` (리소스 태그 기반)**
* **용도:** 작업을 수행하려는 **대상 리소스(예: EC2 인스턴스)**의 태그를 검사합니다.
* **활용:** `Project: DataAnalytics`라는 태그가 붙은 EC2 인스턴스에 대해서만 중지/시작 권한을 부여하는 식의 정교한 제어가 가능합니다.



---

## 📦 S3 정책 작성 시 주의사항 (시험 빈출)

S3 정책을 작성할 때는 **권한의 범위(Scope)**에 따라 ARN 형식을 정확히 구분해야 합니다.

| 구분 | 대상 | ARN 형식 예시 | 관련 액션 |
| --- | --- | --- | --- |
| **버킷 수준** | 버킷 자체에 대한 제어 | `arn:aws:s3:::my-bucket` | `ListBucket`, `GetBucketLocation` |
| **객체 수준** | 버킷 내부 데이터 제어 | `arn:aws:s3:::my-bucket/*` | `GetObject`, `PutObject`, `DeleteObject` |

> [!IMPORTANT]
> 시험에서 객체 삭제/조회 권한을 주면서 ARN 끝에 `/*`를 빠뜨리거나, 리스트 권한을 주면서 `/*`를 붙이는 실수를 유도하는 경우가 많으니 반드시 확인하세요.

---

## 🏢 AWS Organizations 통합 조건

* **`aws:PrincipalOrgID` (조직 단위 제한)**
* **용도:** 특정 AWS Organization ID에 속한 계정들만 리소스에 접근할 수 있도록 제한합니다.
* **활용 예시 (S3 버킷 정책):** 1. S3 버킷 정책에 `PrincipalOrgID` 조건을 추가합니다.
2. 해당 조직에 속한 멤버 계정들은 자유롭게 읽기/쓰기가 가능합니다.
3. 조직 외부의 사용자는 설령 권한이 있더라도 이 조건에 의해 접근이 차단됩니다.

## 1. AWS Secrets Manager 개요

AWS Secrets Manager는 데이터베이스 자격 증명, API 키 및 기타 비밀 정보를 안전하게 관리, 검색 및 교체할 수 있도록 설계된 서비스입니다.

* **주요 목적**: 하드코딩된 비밀 정보 제거 및 보안 강화.
* **자동 교체 (Rotation)**: 지정된 주기(예: X일마다)로 비밀을 자동으로 변경합니다.
* **Lambda 활용**: 새로운 비밀 생성 및 교체 로직은 AWS Lambda 함수를 통해 실행됩니다.
* **기본 통합**: RDS, Redshift, DocumentDB 등은 Lambda 함수를 자동으로 생성/통합해 줍니다.
* **사용자 정의**: 기타 서비스는 직접 Lambda 함수를 작성하여 통합 가능합니다.


* **보안 제어**: 리소스 기반 정책(Resource-based Policy)을 통해 액세스를 상세하게 통제합니다.

---

## 2. 서비스 통합 및 활용 사례

Secrets Manager는 다양한 AWS 서비스와 긴밀하게 연동되어 부팅 시점에 비밀을 안전하게 주입합니다.

### 주요 통합 대상

* **컴퓨팅**: ECS(태스크 환경 변수로 주입), EKS, Fargate, EMR.
* **배포/관리**: CloudFormation(비밀 참조), CodeBuild, SSM Parameter Store.

### ECS 활용 예시

1. **ECS 태스크 실행**: 태스크가 부팅될 때 Secrets Manager와 통신합니다.
2. **비밀 가져오기**: 필요한 비밀 정보를 자동으로 호출합니다.
3. **환경 변수 주입**: 애플리케이션 코드에 노출되지 않도록 환경 변수 형태로 주입되어 RDS 등에 안전하게 접속합니다.

---

## 3. CloudFormation에서의 구성 단계

CloudFormation 템플릿을 통해 Secrets Manager를 설정할 때는 보통 3단계 과정을 거칩니다.

1. **비밀 생성 (Create Secret)**: 저장할 비밀의 이름과 초기 값을 정의합니다.
2. **비밀 참조 (Reference)**: RDS 인스턴스 설정 등에서 해당 비밀을 참조하도록 설정합니다.
3. **비밀 어태치먼트 (Secret Attachment)**: 비밀을 RDS 인스턴스와 연결하여, Secrets Manager가 교체 작업을 수행할 때 RDS의 패스워드도 함께 변경해야 함을 인지시킵니다.

---

## 4. 교차 계정(Cross-Account) 비밀 공유

서로 다른 AWS 계정(예: 보안 계정 vs 개발 계정) 간에 비밀을 공유해야 할 경우, **RAM(Resource Access Manager)은 사용할 수 없습니다.** 대신 다음의 권한 설정이 필요합니다.

### 필수 설정 사항

* **KMS 키 정책 수정**:
* 비밀은 KMS로 암호화되어 있으므로, 개발 계정 사용자가 KMS 복호화(`kms:Decrypt`) 권한을 가져야 합니다.
* `kms:ViaService` 조건을 사용하여 오직 Secrets Manager 서비스로부터의 호출만 허용하도록 제한할 수 있습니다.


* **리소스 기반 정책 첨부**:
* Secrets Manager 비밀 자체에 S3 버킷 정책과 유사한 정책을 첨부합니다.
* 개발 계정의 IAM 사용자나 역할에 `GetSecretValue` 권한을 허용합니다.



---

## 5. Secrets Manager vs SSM Parameter Store 비교

| 특징 | AWS Secrets Manager | SSM Parameter Store |
| --- | --- | --- |
| **주요 용도** | 복잡한 비밀 관리 및 자동 교체 | 일반 설정 값 및 단순 비밀 저장 |
| **비밀 교체** | **기본 지원** (Lambda 자동 생성) | 기본 지원 안 함 (수동 구성 필요) |
| **암호화** | **필수** (KMS 사용) | 선택 사항 |
| **비용** | 상대적으로 높음 | 상대적으로 낮음 (표준 파라미터 무료) |
| **통합** | RDS, Redshift 등과 강력한 통합 | CloudFormation 등과 단순 통합 |

### Parameter Store에서 교체를 구현하려면?

Parameter Store는 기본 교체 기능이 없으므로, **Amazon EventBridge**를 사용하여 주기적으로 Lambda를 호출하고, 해당 Lambda가 직접 패스워드와 파라미터 값을 업데이트하도록 로직을 직접 구축해야 합니다.
## 1. AWS Systems Manager 개요

EC2 인스턴스 및 온프레미스 서버를 대규모로 관리할 수 있는 중앙 집중식 운영 서비스입니다.

* **주요 특징:** 리눅스 및 윈도우 지원, **무료** 제공.
* **통합 서비스:** CloudWatch(메트릭), AWS Config(컴플라이언스), CloudTrail(감사).
* **작동 방식:** 관리 대상 서버에 **SSM 에이전트**가 설치되어야 함.
  * Amazon Linux & 일부 Ubuntu: 기본 설치됨.
  * 기타 OS/온프레미스: 수동 설치 필요.

* **연결 문제 해결 (Troubleshooting):**
  1. 에이전트 설정 및 실행 상태 확인.
  2. **권한 확인:** EC2는 적절한 **IAM Role**이 부여되어야 하며, 온프레미스는 **액세스 키**가 필요함.



---

## 2. 주요 기능 및 아키텍처

### ① Run Command (원격 명령 실행)

SSH 접속 없이 여러 인스턴스에 스크립트나 명령을 동시에 실행합니다.

* **장점:** **22번 포트(SSH)를 열 필요가 없음.** 에이전트가 SSM 서비스와 API로 통신함.
* **제어 기능:**
  * **속도 제어(Velocity Control):** 한 번에 실행할 인스턴스 수 조절.
  * **오류 제어(Error Threshold):** 일정 수 이상의 실패 발생 시 작업 중단 여부 결정.

* **보안:** IAM으로 권한 제어, CloudTrail에 실행 기록 남음.

### ② ASG 수명 주기 후크 (Lifecycle Hooks)와 연동

인스턴스가 종료되기 전 마지막 작업(로그 추출 등)을 수행할 때 사용합니다.

1. ASG가 인스턴스 종료 시 **Terminating:Wait** 상태로 대기.
2. **EventBridge**가 이 이벤트를 감지하여 **SSM 자동화 문서(Automation)** 실행.
3. SSM이 인스턴스에 **SendCommand**를 보내 필요한 작업 수행.
4. 작업 완료 후 수명 주기 후크를 완료시켜 인스턴스 최종 종료.

---

## 3. 패치 및 컴플라이언스 관리

### Patch Manager

대규모 인스턴스에 보안 및 소프트웨어 패치를 자동화합니다.

* **패치 베이스라인(Patch Baseline):** 어떤 패치를 승인/차단할지 정의하는 규칙.
* **패치 그룹(Patch Group):** 환경별(Dev, Test, Prod)로 인스턴스를 분류.
* **유지 관리 기간(Maintenance Windows):** 패치를 실행할 특정 시간대 설정.
* **AWS-RunPatchBaseline:** 실제 패치 작업을 수행하는 명령문.
* **SSM Inventory:** 패치 적용 현황을 모니터링하여 컴플라이언스 준수 여부 확인.

---

## 4. Session Manager (세션 관리자)

SSH 키나 베스천 호스트(Bastion Host) 없이 브라우저나 CLI를 통해 인스턴스에 보안 쉘 접속을 제공합니다.

| 비교 항목 | 기존 SSH 접속 | Session Manager |
| --- | --- | --- |
| **포트 개방** | 22번 포트 오픈 필요 | **모든 인바운드 포트 차단 가능** |
| **인증 방식** | SSH Key Pair 관리 | **IAM Policy** 기반 인증 |
| **로깅/감사** | 개별 로깅 설정 어려움 | **S3, CloudWatch Logs에 모든 명령 기록** |
| **보안성** | 키 유실 위험 | 중앙 집중식 권한 관리 및 감사 가능 |

---

## 5. OpsCenter (운영 센터)

운영 이슈(**OpsItems**)를 한곳에서 집계, 조사 및 해결하는 중앙 대시보드입니다.

* **정보 집계:** AWS Config 변경 이력, CloudTrail 로그, CloudWatch 알람, CloudFormation 스택 등을 하나의 콘솔에 통합.
* **OpsItems 생성:** CloudWatch 알람 위반 시 또는 EventBridge 규칙을 통해 자동 생성 가능.
* **해결:** 이슈 확인 후 즉시 **SSM 자동화 런북(Runbook)**을 실행하여 조치.

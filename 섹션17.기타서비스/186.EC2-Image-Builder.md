## 1. EC2 Image Builder 개요

EC2 Image Builder는 가상 장치(AMI) 및 컨테이너 이미지의 **생성, 관리, 검증 및 테스트를 자동화**하는 완전 관리형 서비스입니다.

* **주요 목적:** 최신 상태의 안전한 골든 이미지(Golden Image)를 자동으로 유지 관리.
* **비용:** 서비스 자체는 **무료**입니다. (단, 이미지를 빌드하고 테스트하는 과정에서 생성되는 EC2 인스턴스, 스토리지 등의 리소스 비용은 발생합니다.)
* **배포 편의성:** 생성된 AMI를 **여러 리전(Multi-Region)** 및 **여러 계정(Multi-Account)**으로 간편하게 배포할 수 있습니다.
* **자동화 스케줄링:** 매주 정기적 빌드 또는 소프트웨어 패키지 업데이트 시 자동 빌드가 가능합니다.

---

## 2. 이미지 빌드 및 작동 프로세스

이미지가 생성되는 과정은 크게 빌드와 테스트 두 단계로 나뉩니다.

1. **빌더 인스턴스 생성:** 이미지 빌더가 아무것도 설치되지 않은 순수 EC2 인스턴스를 실행합니다.
2. **빌드 컴포넌트 실행:** 사용자가 설정한 '빌드 명령어'를 기반으로 소프트웨어를 설치하고 구성합니다. 이 단계에서 실제 AMI가 생성됩니다.
3. **검증 및 테스트:**
   * 생성된 AMI를 사용하여 **새로운 테스트용 인스턴스**를 생성합니다.
   * 이미지가 올바르게 동작하는지, 보안 정책을 준수하는지 등을 자동으로 테스트합니다.

4. **배포:** 테스트를 통과한 AMI를 대상 리전 및 계정으로 발행합니다.

---

## 3. EC2 Image Builder CI/CD 아키텍처

코드 변경부터 운영 환경 반영까지 전체 과정을 자동화하는 파이프라인 구성 예시입니다.

### 단계별 흐름

| 단계 | 도구 | 역할 |
| --- | --- | --- |
| **1. 소스 관리** | **AWS CodeCommit** | 개발자가 푸시한 소스 코드를 관리 및 저장합니다. |
| **2. 빌드** | **AWS CodeBuild** | 소스 코드를 컴파일하고 실행 파일을 생성(빌드)합니다. |
| **3. AMI 생성** | **EC2 Image Builder** | CodeBuild의 결과물을 가져와 CloudFormation에 의해 실행되며, 최신 AMI를 생성 및 검증합니다. |
| **4. 롤아웃(배포)** | **CloudFormation** | 새 AMI를 사용하여 **Auto Scaling Group**의 인스턴스들을 롤링 업데이트 방식으로 교체합니다. |

### 전체 자동화 프로세스 요약

1. **CodeCommit**에 코드가 푸시되면 파이프라인이 시작됩니다.
2. **CodeBuild**를 통해 애플리케이션이 빌드됩니다.
3. **CloudFormation**이 **EC2 Image Builder**를 호출하여 새 AMI를 만듭니다.
4. 마지막으로 **CloudFormation**이 오토 스케일링 그룹의 이미지를 새 버전으로 업데이트하여, 운영 중인 모든 인스턴스가 순차적으로 최신화됩니다.